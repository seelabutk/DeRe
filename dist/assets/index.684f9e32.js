var mt=Object.defineProperty,vt=Object.defineProperties;var pt=Object.getOwnPropertyDescriptors;var tt=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var nt=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pe=(e,t)=>{for(var n in t||(t={}))yt.call(t,n)&&nt(e,n,t[n]);if(tt)for(var n of tt(t))xt.call(t,n)&&nt(e,n,t[n]);return e},Be=(e,t)=>vt(e,pt(t));import{$ as at,o as j,c as Z,n as K,a as C,m as Je,t as qe,b as Ke,F as Fe,r as Ne,d as ot,i as Oe,g as Mt,e as _,f as F,h as xe,j as Ct,w as it,k as Ze,l as bt,p as ze,q as Ye,s as _t,u as He,v as Ue,x as st,y as kt,z as wt,P as Dt,A as ce,B as pe,C as St,D as $t,E as It,G as Rt,H as Tt,I as Pt,J as Ot,K as At,L as Lt,M as Vt,N as Et,O as Ft,Q as Nt,R as Ht,S as Bt,T as Ut,U as jt,V as zt,W as Yt,X as Wt}from"./vendor.23db5a8c.js";const Xt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}};Xt();const Jt="0.0.7",qt={mappings:{loomHover:"loomButton"},spatialTransform:{horizontal_buttons_to_dropdown:!0,vertical_buttons_to_dropdown:!0}};var Se={version:Jt,mobile:qt};function Kt(e,t){return e?lt(t,o=>o.hide!==!0&&o.id!="-1"&&(Ge(e,o)||e.deactivateOnTransition!==!0&&rt(t,o,e)||o.parent_id=="-1")||o.important):{}}function Ge(e,t){return e&&e.hasOwnProperty("children")?Object.keys(e.children).includes(String(t.id)):!1}function rt(e,t,n){return Ge(e[n.parent_id],t)}function lt(e,t){const n={};return Object.keys(e).filter(o=>t(e[o])).forEach(o=>n[o]=e[o]),n}function Zt(e){const t=[];return Object.keys(e).forEach(n=>t[n]=e[n]),t}function Gt(e){const t={};return e.forEach((n,o)=>t[o]=n),t}function Qt(e){const t={};return Object.entries(e).forEach(([n,o])=>{t[n]=o}),t}function en(e,t=void 0){const n={};return Object.keys(e).forEach(o=>{e[o]!==Object(e[o])?n[o]=e[o]:t!==void 0&&(n[o]=t)}),n}function je(e){if(typeof e=="object"&&e!==null)if(e.constructor===Array){const t=[];return e.forEach(n=>{t.push(je(n))}),t}else{const t={};return Object.entries(e).forEach(([n,o])=>{t[n]=je(o)}),t}return e}function tn(e,t){const n=je(e),o=je(t);return function a(l,i){let d={};return[...new Set(Object.keys(l).concat(Object.keys(i)))].forEach(c=>{i[c]===null||(i[c]===void 0||Object.keys(i[c]).length==0||l[c]!==Object(l[c])||i[c]!==Object(i[c])?d[c]=i[c]!==void 0?i[c]:l[c]:d[c]=a(l[c],i[c]))}),d}(n,o)}function nn(e,t){const n=[];for(let o=0;o<e.rows;o++)for(let a=0;a<e.cols;a++){const l=Array.from(e.ucharPtr(o,a)).slice(0,3),i=Array.from(t.ucharPtr(o,a));l.map((c,w)=>[c,i[w]]).forEach(c=>n.push(Math.abs(c[1]-c[0])))}return n}function an(e,t){return e.map(n=>({x:n.x*t.x,y:n.y*t.y}))}function on(e){let t="";t+=`M ${e[0].x} ${e[0].y} `;for(let n=1;n<e.length;++n)t+=`L ${e[n].x} ${e[n].y} `;return t+=`L ${e[0].x} ${e[0].y} `,new Path2D(t)}function sn(e,t,n){t===void 0&&(t=Math.min(...e.map(a=>a.x))),n===void 0&&(n=Math.min(...e.map(a=>a.y)));let o="";return e.forEach((a,l)=>{o+=(a.x-t).toPrecision(4)+","+(a.y-n).toPrecision(4),l!==e.length-1&&(o+=" ")}),o}function rn(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}function ln(e){let t=1/0,n=0,o=1/0,a=0;return e.forEach(l=>{t=Math.min(t,l.x),n=Math.max(n,l.x),o=Math.min(o,l.y),a=Math.max(a,l.y)}),{xmin:t,xmax:n,ymin:o,ymax:a}}function cn(e,t,n){return Math.min(Math.max(t,e),n)}function un(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function dn(e){return new Promise(t=>setTimeout(t,e))}function fn(e,t,n=0){let o={};return function(){o[n]||(e.apply(this,arguments),o[n]=!0,setTimeout(function(){delete o[n]},t))}}function gn(e,t,n){const a=document.elementsFromPoint(t,n).find(d=>d.nodeName=="polygon");if(a===void 0)return null;if(a.isPointInFill){const d=a.getBoundingClientRect(),c=a.parentElement.createSVGPoint();if(c.x=t-d.left,c.y=n-d.top,!a.isPointInFill(c))return null}const l=a.parentElement.parentElement.id,i=e.activeComponents.value[l];return i===void 0||!i.isLoomComponent?null:i}var T={currentTargets:Kt,isChild:Ge,isSibling:rt,objectFilter:lt,arrayToObject:Gt,ObjectToArray:Zt,shallowCopy:Qt,shallowCopyPrimitivesOnly:en,deepCopy:je,deepMerge:tn,absdiff:nn,scalePolygon:an,polyToPath2D:on,polyToPolyString:sn,rectToPoly:rn,boundingBox:ln,bound:cn,dist:un,sleep:dn,throttle:fn,getComponentFromPoint:gn};function hn(e,t){if(t.children===void 0)return[];let n=Object.keys(t.children).map(d=>e[d]).filter(d=>Object.keys(d.shape.points).length==4).map(d=>[d]);n.forEach((d,c)=>d[0].group=c);const o=5,a=20,l=5,i=5;for(let d=1;d<n.length;++d)for(let c=0;c<d;++c){const w=n[c].length;for(let O=0;O<w;++O){const Y=n[d][0],z=n[c][O];if(!(!Y||!z)&&(Se.mobile&&Se.mobile.spatialTransform&&Se.mobile.spatialTransform.horizontal_buttons_to_dropdown&&Math.abs(Y.shape.dimensions.centerY-z.shape.dimensions.centerY)<=o&&Math.abs(Y.shape.dimensions.min_x-z.shape.dimensions.max_x)<=a||Se.mobile&&Se.mobile.spatialTransform&&Se.mobile.spatialTransform.vertical_buttons_to_dropdown&&Math.abs(Y.shape.dimensions.min_y-z.shape.dimensions.max_y)<=i&&Math.abs(Y.shape.dimensions.centerX-z.shape.dimensions.centerY<=l))){const V=Y.group;n[V].forEach(he=>he.group=c),n[c]=n[c].concat(n[V]),n[V]=[]}}}return n=n.filter(d=>d.length>1),n}function mn(e){const t=(e.max_x-e.min_x)/2,n=Math.max(Math.ceil(Math.pow(t,2/3)),5),o=[];for(let l=0;l<n;++l){const i=2*Math.PI*l/n;o.push({x:Math.sin(i)*t+e.min_x+(e.max_x-e.min_x)/2,y:Math.cos(i)*t+e.min_y+(e.max_y-e.min_y)/2})}const a=Be(Pe({},e),{min_y:e.centerY-t,max_y:e.centerY+t});return[o,a]}function vn(e,t,n){hn(e,e[n]).forEach(a=>{let l=1/0,i=0,d=1/0,c=0;const w=a.map(()=>({}));for(const V in w)w[V]={},l=Math.min(a[V].shape.dimensions.min_x,l),i=Math.max(a[V].shape.dimensions.max_x,i),d=Math.min(a[V].shape.dimensions.min_y,d),c=Math.max(a[V].shape.dimensions.max_y,c);const O=Object.values(a).map(V=>V.id),Y=O.join(),z={actor:"dropdown",type:"linear",name:a.map(V=>V.name).join("-"),id:Y,parent:e[n].name||"root",parent_id:e[n].id!==void 0?e[n].id:"-1",children:w,frame_no:-1,child_visit_counter:Object.keys(w).length,shape:{type:"poly",points:{0:{x:l,y:d},1:{x:i,y:d},2:{x:i,y:c},3:{x:l,y:c}},dimensions:{min_x:l,max_x:i,min_y:d,max_y:c}}};O.forEach(V=>t[V]={hide:!0,parent_id:z.id,parent:z.name}),t[Y]=z})}function pn(e,t,n){["button","hover"].includes(e[n].actor)&&e[n].shape.points.length==4&&([points,dimensions]=mn(e[n].shape.dimensions),t[n].shape={points,dimensions})}function yn(e,t){const n=[];for(n.push("-1");n.length;){const o=n.shift();t[o]!==null&&(vn(e,t,o),pn(e,t,o),e[o].hasOwnProperty("children")&&t[o]!==null&&n.push(...Object.keys(e[o].children)))}}function xn(e){const t={mode:"mobile"};return yn(T.shallowCopy(e),t),t}function Mn(e,t,n){if(n==e.info.mode)return{};let o={};switch(n){case"mobile":o.info={mode:"mobile"},o.data=xn(t);break}return o}const We={props:["parent","vcTargetData","targetData","showHint","interactable","current_state","targets"],emits:["changeState","addHistory"],name:"loomComponent",data:function(){return{isLoomComponent:!0,points:null,eventData:{}}},computed:{renderMode(){return this.$parent.renderMode},instanceID(){return this.$parent.instanceID},page(){return this.$parent.page},vcid(){return this.$parent.id},id(){return this.targetData.id},scale(){return this.vcTargetData.scale||{x:1,y:1}},frame(){return this.targetData.frame_no+1},componentID(){return`${this.instanceID}-${this.page}-${this.vcid}-${this.id}`},calcHintStyle(){return{fill:"rgba(246, 230, 80, 0.7)",stroke:"rgba(250, 240, 80, 0.8)","stroke-width":"2"}},calcStyle(){const e=this.targetData;let t="";const n=T.ObjectToArray(e.shape.points),o=T.scalePolygon(n,this.scale),a=e.shape.dimensions.min_x*this.scale.x,l=e.shape.dimensions.min_y*this.scale.y,i=e.shape.dimensions.max_x*this.scale.x,d=e.shape.dimensions.max_y*this.scale.y,c=o.length;return o.forEach((O,Y)=>{t+=`${O.x-a},${O.y-l}`,Y!==c-1&&(t+=" ")}),this.points=t,{position:"absolute",top:`${parseInt(l)}px`,left:`${parseInt(a)}px`,width:`${parseInt(i-a)}px`,height:`${parseInt(d-l)}px`}}},mounted(){this.$refs.target&&(this.$refs.target.style.display=this.interactable?"block":"none"),this.emitter.emit("addComponent",[this.componentID,this])},beforeUnmount(){this.emitter.emit("removeComponent",this.componentID)},watch:{interactable:function(e){this.$refs.target&&(this.$refs.target.style.display=e?"block":"none")}}};var _e=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n};const Cn={name:"loomBrushingBox",mixins:[We],data:function(){return{brushing:{state:!1,start_x:0,start_y:0,end_x:0,end_y:0}}},computed:{brushingBoxStyle:function(){return{position:"absolute",visibility:this.brushing.state?"visible":"hidden",top:this.brushing.start_y+"px",left:this.brushing.start_x+"px",width:this.brushing.end_x-this.brushing.start_x+"px",height:this.brushing.end_y-this.brushing.start_y+"px"}}},mounted:function(){this.eventData.mousedown=function(e){let t=e.currentTarget;var n=at(t).offset(),o=e.pageX-n.left,a=e.pageY-n.top;this.brushing.state=!0,this.brushing.start_x=this.brushing.end_x=o,this.brushing.start_y=this.brushing.end_y=a,this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseup=function(e){this.brushing.state=!1}.bind(this),this.eventData.mousemove=function(e){if(this.brushing.state==!1)return;const t=e.currentTarget,n=at(t).offset(),o=this.targetData.shape.dimensions.max_x-this.targetData.shape.dimensions.min_x,a=this.targetData.shape.dimensions.max_y-this.targetData.shape.dimensions.min_y;this.brushing.end_x=e.pageX-n.left,this.brushing.end_y=e.pageY-n.top;const l=6,i=o/l,d=a/l,c=Math.round(this.brushing.start_x/i),w=Math.round(this.brushing.start_y/d),O=Math.round((this.brushing.end_x-this.brushing.start_x)/i),z=(Math.round((this.brushing.end_y-this.brushing.start_y)/d)-1)*l**0+O*l**1+w*l**2+c*l**3;this.$emit("changeState",this.targetData.id,z)}.bind(this)}},bn=["id"],_n=["width","height"],kn=["points"];function wn(e,t,n,o,a,l){return j(),Z("div",{ref:"target",id:e.componentID,style:K(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),Z("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:K([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",Je({ref:"polygon"},qe(e.eventData),{points:e.points,style:{cursor:"cell"}}),null,16,kn)],12,_n)):Ke("",!0),C("div",{id:"brushing-box",ref:"brushing-box",style:K(l.brushingBoxStyle)},null,4)],12,bn)}var Dn=_e(Cn,[["render",wn],["__scopeId","data-v-8b1e5c1e"]]);const Sn={name:"loomButton",mixins:[We],mounted:function(){this.eventData.click=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this)}},$n=["id"],In=["width","height"],Rn=["points"];function Tn(e,t,n,o,a,l){return j(),Z("div",{ref:"target",id:e.componentID,style:K(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),Z("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:K([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",Je({ref:"polygon"},qe(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Rn)],12,In)):Ke("",!0)],12,$n)}var Pn=_e(Sn,[["render",Tn]]);const On={name:"loomHover",mixins:[We],emits:["onmouseleave"],mounted:function(){this.eventData.mouseover=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseleave=function(e){this.$emit("onmouseleave")}.bind(this)}},An=["id"],Ln=["width","height"],Vn=["points"];function En(e,t,n,o,a,l){return j(),Z("div",{ref:"target",id:e.componentID,style:K(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),Z("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:K([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",Je({ref:"polygon"},qe(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Vn)],12,Ln)):Ke("",!0)],12,An)}var Fn=_e(On,[["render",En]]);const Nn={name:"loomDropdown",mixins:[We],methods:{onChange(e){const t=this.targets[Object.keys(this.targetData.children)[e.target.selectedIndex]];this.$emit("changeState",t.id),this.$emit("addHistory",t,e)}},mounted(){this.$nextTick(()=>{this.$refs.dropdown.value=this.$parent.current_state.name})}},Hn=["id"];function Bn(e,t,n,o,a,l){return j(),Z("select",{ref:"dropdown",id:e.componentID,style:K(e.calcStyle),onChange:t[0]||(t[0]=(...i)=>l.onChange&&l.onChange(...i))},[(j(!0),Z(Fe,null,Ne(Object.keys(e.targetData.children),i=>(j(),Z("option",{key:i},ot(e.targets[i].name),1))),128))],44,Hn)}var Un=_e(Nn,[["render",Bn]]);const jn={name:"USAMap",props:["targetData","vcTargetData"],inject:["manager"],computed:{width(){return this.$parent.targetData.width*this.scale.x},height(){return this.$parent.targetData.height*this.scale.y},scale(){return this.vcTargetData.scale||{x:1,y:1}},calcStyle(){return{position:"absolute",top:"0px",left:"0px",width:`${this.width}px`,height:`${this.height}px`,backgroundColor:"rgba(0,0,0,0.2)",backgroundImage:`url(assets/USA_${this.projectionType}.png)`,backgroundSize:`${this.width}px ${this.height}px`}},stateCenters(){return this.stateCentersTypes[this.projectionType]}},data:function(){return{projectionTypes:["mercator","lambert"],projectionType:null,stateCentersTypes:{mercator:{WA:{x:.084,y:.097},ID:{x:.183,y:.266},MT:{x:.267,y:.115},ND:{x:.425,y:.095},MN:{x:.527,y:.145},MI:{x:.691,y:.27},ME:{x:.958,y:.192},OR:{x:.077,y:.261},WY:{x:.304,y:.286},SD:{x:.427,y:.229},WI:{x:.602,y:.22},NY:{x:.856,y:.295},VT:{x:.895,y:.25},NH:{x:.915,y:.275},MA:{x:.917,y:.314},CT:{x:.892,y:.353},RI:{x:.914,y:.353},CA:{x:.09,y:.526},NV:{x:.142,y:.427},UT:{x:.23,y:.439},CO:{x:.334,y:.457},NE:{x:.431,y:.354},IA:{x:.542,y:.33},IL:{x:.616,y:.411},IN:{x:.664,y:.414},OH:{x:.722,y:.402},PA:{x:.811,y:.384},NJ:{x:.862,y:.425},KS:{x:.455,y:.473},MO:{x:.557,y:.478},KY:{x:.685,y:.511},WV:{x:.762,y:.464},MD:{x:.847,y:.476},DE:{x:.858,y:.455},VA:{x:.801,y:.51},AZ:{x:.23,y:.633},NM:{x:.327,y:.628},TX:{x:.451,y:.743},OK:{x:.477,y:.589},AR:{x:.56,y:.614},TN:{x:.664,y:.578},NC:{x:.785,y:.58},LA:{x:.556,y:.727},MS:{x:.606,y:.69},AL:{x:.657,y:.691},GA:{x:.715,y:.691},SC:{x:.761,y:.651},FL:{x:.741,y:.848}},lambert:{WA:{x:.221,y:.079},ID:{x:.29,y:.241},MT:{x:.377,y:.141},ND:{x:.502,y:.147},MN:{x:.589,y:.203},MI:{x:.742,y:.285},ME:{x:.961,y:.132},OR:{x:.195,y:.203},WY:{x:.391,y:.303},SD:{x:.503,y:.262},WI:{x:.663,y:.253},NY:{x:.891,y:.25},VT:{x:.918,y:.206},NH:{x:.939,y:.212},MA:{x:.939,y:.253},CT:{x:.931,y:.285},RI:{x:.949,y:.282},CA:{x:.173,y:.453},NV:{x:.237,y:.385},UT:{x:.315,y:.429},CO:{x:.412,y:.462},NE:{x:.512,y:.376},IA:{x:.609,y:.359},IL:{x:.675,y:.421},IN:{x:.727,y:.415},OH:{x:.781,y:.391},PA:{x:.859,y:.341},NJ:{x:.914,y:.356},KS:{x:.529,y:.494},MO:{x:.633,y:.503},KY:{x:.747,y:.503},WV:{x:.815,y:.45},MD:{x:.88,y:.397},DE:{x:.901,y:.406},VA:{x:.854,y:.485},AZ:{x:.296,y:.612},NM:{x:.391,y:.629},TX:{x:.508,y:.756},OK:{x:.549,y:.603},AR:{x:.63,y:.629},TN:{x:.734,y:.574},NC:{x:.854,y:.556},LA:{x:.633,y:.768},MS:{x:.68,y:.697},AL:{x:.731,y:.688},GA:{x:.793,y:.691},SC:{x:.835,y:.626},FL:{x:.84,y:.844},AL:{x:.175,y:.821},HI:{x:.414,y:.974}}}}},methods:{getRelativeStateCenters(){const e=this.$refs.target.getBoundingClientRect();return Object.fromEntries(Object.entries(this.stateCenters).map(([t,n])=>[t,{x:n.x*this.width+e.x,y:n.y*this.height+e.y}]))},async getMapping(){return await this.$nextTick(()=>Object.fromEntries(Object.entries(this.getRelativeStateCenters()).map(([t,n])=>{const o=T.getComponentFromPoint(this.manager,...Object.values(n));return o===null?null:[t,{mode:o.renderMode,instance:o.instanceID,page:o.page,vcid:o.vcid,frame:o.frame}]}).filter(t=>t!=null)))}},mounted:function(){this.projectionType="lambert"}};function zn(e,t,n,o,a,l){return j(),Z("div",{ref:"target",style:K(l.calcStyle),onClick:t[0]||(t[0]=(...i)=>e.onclick&&e.onclick(...i))},null,4)}var Yn=_e(jn,[["render",zn]]);const Wn={name:"loomVideoCanvas",emits:["frame_processed"],props:["frameLinkMode","moveRegionMode","editRegionMode","overlay","renderMode","renderAppMode","info","targets","targetData","instanceID","start_state_id"],components:{loomButton:Pn,loomHover:Fn,loomDropdown:Un,loomBrushingBox:Dn,loomUSA:Yn},setup(e,t){const n=Oe("manager"),o=Mt(),a=Oe("emitter"),{loomVideoCanvasRefs:l}=Oe(`instance-${e.instanceID}`),i=n.appRefs[e.instanceID],d=_(100),c=_({x:1,y:1}),w=_(null),O=_(null),Y=F(()=>l[z.value]),z=F(()=>e.targetData.id),V=F(()=>e.targetData.page),he=F(()=>e.renderAppMode),ue=F(()=>e.instanceID),G=F(()=>e.targetData.width||e.info.window.width),Me=F(()=>G*c.x),N=F(()=>e.targetData.height||e.info.window.height),re=F(()=>N*c.y),$e=F(()=>e.targetData.top||0),Te=F(()=>e.targetData.left||0),ae=F(()=>l[e.targetData.parentCanvas]||!1),me=xe({}),Ce=_(-1),de=_(!1),b=_(!1),x=F(()=>me[Ie.value]),H=F(()=>T.scalePolygon(x.value,c.value)),oe=F(()=>T.polyToPolyString(x.value,0,0)),fe=F(()=>T.polyToPolyString(H.value,0,0)),Ie=F(()=>{for(let s=Le.value;s&&s.parent_id!=s.id;s=e.targets[s.parent_id])if(me[s.id])return s.id;return-1}),ke=()=>{const s={x:ie.value.x-se.value.x,y:ie.value.y-se.value.y},m=c.value;c.value={x:(c.value.x*G.value+s.x)/G.value,y:(c.value.y*N.value+s.y)/N.value};const D={x:m.x-c.value.x,y:m.y-c.value.y};e.targetData.scale=c.value;const h=T.boundingBox(x.value);e.targetData.left+=D.x*h.xmin,e.targetData.top+=D.y*h.ymin,P()},be=s=>{const m=10,D=Ce.value,h=x.value.length,J=(D+1)%h,S=((D-1)%h+h)%h;if(T.dist(x.value[D],x.value[J])<m||T.dist(x.value[D],x.value[S])<m){x.value.splice(D,1),de.value=!1,P();return}s.x=T.bound(s.x,0,G.value*c.value.x),s.y=T.bound(s.y,0,N.value*c.value.y),x.value[D]={x:s.x/c.value.x,y:s.y/c.value.y};const q=ae.value;if(!q){P();return}const ee=q.targetData.cutouts,R=ee.findIndex(ne=>ne.id==e.targetData.id);if(R>=0){const ne=ee[R];ne.poly=x.value,ee.splice(R,1,ne)}P()},le=(s,m)=>{x.value.splice(s+1,0,{x:m.x/c.value.x,y:m.y/c.value.y}),de.value=!0,Ce.value=s+1,P()},ye=s=>{if(!e.editRegionMode)return-1;const m=2,h=Math.ceil(8/2+m/2);return H.value.map(S=>{let q=0,ee=0;h>S.x?q=-(S.x-h):Me.value<S.x+h&&(q=Me.value-(S.x+h)),h>S.y?ee=-(S.y-h):re.value<S.y+h&&(ee=re.value-(S.y+h));const R=[{x:S.x+q-h,y:S.y+ee-h},{x:S.x+q+h,y:S.y+ee-h},{x:S.x+q+h,y:S.y+ee+h},{x:S.x+q-h,y:S.y+ee+h}];return T.polyToPath2D(R)}).findIndex(S=>p.value.isPointInPath(S,s.x,s.y))},B=s=>e.editRegionMode?H.value.map((D,h,J)=>{const S=(h+1)%J.length,q=J[S];return T.polyToPath2D([D,q])}).findIndex(D=>p.value.isPointInStroke(D,s.x,s.y)):-1,Re=(s,m)=>{const D="#ff0000",h=2,J=8;s.lineWidth=h,s.strokeStyle=D;let S=function(q,ee){const R=Math.ceil(J/2+h/2);s.strokeRect(T.bound(q,R,G.value-R)-R,T.bound(ee,R,N.value-R)-R,J,J)}.bind(Y.value);s.beginPath(),s.moveTo(T.bound(m[0].x,h/2,G.value-h/2),T.bound(m[0].y,h/2,N.value-h/2));for(let q=1;q<m.length;++q)s.lineTo(T.bound(m[q].x,h/2,G.value-h/2),T.bound(m[q].y,h/2,N.value-h/2));s.closePath(),s.stroke(),m.forEach(q=>S(q.x,q.y))},I=_({x:0,y:0}),A=_({x:0,y:0}),se=_({x:0,y:0}),ie=_({x:0,y:0}),we=_(!1),{editRegionMode:De}=Ct(e),Ae=F(()=>{const s=Math.min(I.value.y,A.value.y)+"px",m=Math.min(I.value.x,A.value.x)+"px",D=Math.abs(A.value.x-I.value.x)+"px",h=Math.abs(A.value.y-I.value.y)+"px";return{position:"absolute",display:L.value?"block":"none","background-color":"rgba(0, 0, 0, 0.5)","border-style":"dashed","pointer-events":"none",top:s,left:m,width:D,height:h}});it(De,()=>{P(!1,!0)});const r=s=>{const{left:m,top:D}=w.value.getBoundingClientRect();return{x:s.clientX-m-e.targetData.left,y:s.clientY-D-e.targetData.top}},f=s=>{if(se.value=ie.value,ie.value=r(s),de.value&&e.targetData.reshapeable!==!1){be(ie.value);return}else if(b.value&&e.targetData.resizeable!==!1){ke();return}else De.value&&(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)&&(ye(ie.value)>=0?document.body.style.cursor="move":B(ie.value)>=0&&(document.body.style.cursor="crosshair"));we.value&&e.targetData.movable!==!1&&(e.moveRegionMode&&(e.targetData.top+=s.movementY,e.targetData.left+=s.movementX),A.value=ie.value)},y=s=>{const m=r(s),D=s.shiftKey;if(De.value&&(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)){const h=ye(m);if(h>=0&&(D&&e.targetData.resizeable!==!1?(b.value=!0,de.value=!1):e.targetData.reshapeable!==!1&&(b.value=!1,de.value=!0,Ce.value=h)),h<0&&e.targetData.reshapeable!==!1){const J=B(m);J>=0&&(le(J,m),P())}}},M=s=>(a.emit("deselectAll"),document.body.style.cursor="default",ie.value=r(s),De.value?A.value=I.value=ie.value:A.value=I.value={x:-1e4,y:-1e4},we.value=!0,a.emit("selectVideoCanvas",Y.value),!1),v=s=>{we.value=!1,b.value=!1,de.value=!1,document.body.style.cursor="default"},E=()=>{I.value=A.value={x:-1e4,y:-1e4}},W=()=>{we.value=!1,I.value.x=I.value.y=A.value.x=A.value.y=-1e4},L=F(()=>!(!De.value||e.moveRegionMode||I.value.x==-1e4||I.value.y==-1e4||A.value.x==-1e4||A.value.y==-1e4||Math.abs(A.value.x-I.value.x)<5||Math.abs(A.value.y-I.value.y)<5));it(L,s=>{a.emit("regionExists",{exists:s,origin:Y.value})});const ge=()=>{I.value.x>A.value.x&&([I.value.x,A.value.x]=[A.value.x,I.value.x]),I.value.y>A.value.y&&([I.value.y,A.value.y]=[A.value.y,I.value.y]),g(T.rectToPoly({x:I.value.x,y:I.value.y,width:A.value.x-I.value.x,height:A.value.y-I.value.y})),I.value=A.value={x:-1e4,y:-1e4}},u=(s,m=!0)=>{g(s,!1,m)},g=(s,m=!0,D=!0)=>{if(s.length>0&&!e.targetData.parentCanvas){i.newVideoTarget({parentCanvas:e.targetData.id,startupFn:h=>{h.cutRegions(s,m,D),h.emitter.emit("deselectAll"),delete h.targetData.startupFn},processed:!0});return}s.length>0&&s[0].constructor!==Array&&(s=[s]),s.forEach(h=>{const J=String(Object.keys(i.currentVideoTargets).length);i.currentVideoTargets[J]={page:e.targetData.page,id:J,current_state_id:Le.value.id,region:h,top:e.targetData.top,left:e.targetData.left,makeCutout:m,parentCanvas:e.targetData.id,cutouts:[],startupFn:S=>{S.emitter.emit("deselectAll"),delete S.targetData.startupFn},processed:!0}})},p=_(null),P=(s=!1,m=!1)=>{a.emit("changeVideoFrame",[e.instanceID,V.value,z.value,Q.value,Q.value,s,m])},U=(s,m=!0)=>{if(!(te.value||!s)){if(p.value.restore(),p.value.save(),p.value.fillStyle="rgba(0, 0, 0, 0)",p.value.clearRect(0,0,G.value,N.value),e.targetData.drawImage!==!1){const D=s.videoWidth/s.clientWidth,h=s.videoHeight/s.clientHeight;p.value.drawImage(s,0,0,G.value*D,N.value*h,0,0,G.value,N.value)}De.value&&x.value&&Re(p.value,x.value),m&&a.emit("post_redraw"+e.targetData.id),X(),te.value=!0,setTimeout(()=>te.value=!1,20)}},X=()=>{if(e.targetData.processed||!O.value)return;const s=cv.imread(O.value);cv.cvtColor(s,s,cv.COLOR_RGBA2GRAY,0),cv.threshold(s,s,254,255,cv.THRESH_BINARY);const m=new cv.MatVector,D=new cv.Mat;cv.findContours(s,m,D,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);const h=[],J=Array.from(D.data32S);for(;J.length>0;)h.push(J.splice(0,4));const S=[];h.forEach((R,ne)=>{R[2]!=-1&&R[3]==-1&&S.push(ne)});function q(R,ne){const Ve={left:R.x,top:R.y,right:R.x+R.width,bottom:R.y+R.height},Ee={left:ne.x,top:ne.y,right:ne.x+ne.width,bottom:ne.y+ne.height};return!(Ee.left>Ve.right||Ee.right<Ve.left||Ee.top>Ve.bottom||Ee.bottom<Ve.top)}const ee=S.filter(R=>cv.contourArea(m.get(parseInt(R)),!1)>1e3).map(R=>cv.boundingRect(m.get(parseInt(R)))).sort((R,ne)=>R.width*R.height>ne.width*ne.height).filter((R,ne,Ve)=>!Ve.slice(ne+1).some(Ee=>q(Ee,R))).filter(R=>Math.abs(G.value-R.width)>100&&Math.abs(N.value-R.height)>100).map(T.rectToPoly);ee.length!=0&&g(ee,!0,!0),s.delete(),m.delete(),D.delete(),t.emit("frame_processed")},Q=_(null),te=_(!1),k=_(!0),ve=(s,m=0,D=!0,h=!0)=>{Qe(e.targets[s].frame_no,m,D,h)},Qe=(s,m=0,D=!0,h=!0)=>{const J=s+1+m;if(Q.value==J)return;a.emit("changeVideoFrame",[e.instanceID,V.value,z.value,Q.value,J,h])[0].some(ee=>ee.instance==ue.value&&ee.page==V.value&&ee.vcid==z.value)&&(Q.value=J,D&&k.value&&i.changeStateWithFrameNo(s,m),e.targetData.current_state_id=Object.values(e.targets).find(ee=>ee.frame_no==s).id)},dt=(s,m)=>{i.updateInteractionHistory(s,m,e.targetData.id)},ft=xe({}),Le=F(()=>Object.values(e.targets).find(s=>s.id==e.targetData.current_state_id)||Object.values(e.targets).sort((s,m)=>s.frame_no-m.frame_no)[0]),gt=F(()=>T.currentTargets(Le.value,e.targets)),ht=s=>{if(s.id=="-1")return;const m=`loom${s.actor.charAt(0).toUpperCase()+s.actor.slice(1)}`;if(Se[e.renderAppMode]&&Se[e.renderAppMode].mappings){const D=Se[e.renderAppMode].mappings[m];if(D&&o.components[D])return o.components[D]}if(o.components[m])return o.components[m]};Ze(()=>{if(p.value=O.value.getContext("2d"),p.value.save(),V.value==i.currentPage&&e.start_state_id!==void 0&&(e.targetData.current_state_id=e.start_state_id),Le.value!==void 0&&(ve(Le.value.id,0,!1),e.targetData.region?me[Ie.value]=e.targetData.region:me[Ie.value]=[{x:0,y:0},{x:G.value,y:0},{x:G.value,y:N.value},{x:0,y:N.value}],e.targetData.makeCutout&&i)){const s=x.value,m=Math.min(...s.map(S=>S.x)),D=Math.max(...s.map(S=>S.x)),h=Math.min(...s.map(S=>S.y)),J=Math.max(...s.map(S=>S.y));ae.value&&ae.value.targetData.cutouts.push({poly:x.value,width:D-m,height:J-h,top:h,left:m,id:e.targetData.id})}e.targetData.startupFn&&e.targetData.startupFn(Y.value),a.on("clearSelection",E),a.on("deselectAll",W),a.on(`changeState-${e.targetData.id}`,ve),a.on("mousemove",f),a.on("mouseup",v),a.on("mousedown",y),we.value=!1,a.emit("selectVideoCanvas",Y.value)}),bt(()=>{if(ae.value&&ae.value.targetData){const s=ae.value.targetData.cutouts.findIndex(m=>m.id===e.targetData.id);s>=0&&ae.value.targetData.cutouts.splice(s,1)}a.off("clearSelection",E),a.off("deselectAll",W),a.off(`changeState-${e.targetData.id}`,ve),a.off("mousemove",f),a.off("mouseup",v),a.off("mousedown",y)});const et={utils:T,zIndex:d,selected:we,dragStart:I,dragCurr:A,lastMouseLoc:se,mouseLoc:ie,reshapePolygonMode:de,resizePolygonMode:b,ctx:p,polygonMasks:me,polygonReshapeIdx:Ce,updateParentCurrentState:k,lastFrame:Q,throttle:te,editRegionMode:De,scale:c,loomVideoCanvasRefs:l,componentRefs:ft,instanceRef:i,canvasRef:O,containerRef:w,current_state:Le,currentTargets:gt,id:z,page:V,mode:he,instance:ue,width:G,scaledWidth:Me,height:N,scaledHeight:re,top:$e,left:Te,parentCanvasRef:ae,currentPolygonMaskID:Ie,currentPolygonMask:x,currentPolygonMaskScaled:H,currentPolygonMaskString:oe,currentPolygonMaskStringScaled:fe,regionExists:L,dragSelectStyle:Ae,getComponent:ht,changeState:ve,changeStateWithFrameNo:Qe,addHistory:dt,cutSelectedRegion:ge,copyRegions:u,cutRegions:g,resizePolygon:ke,reshapePolygon:be,addNewVertex:le,isPolygonVertexHovered:ye,isPolygonLineHovered:B,clientToOffset:r,onScreenMouseMove:f,onScreenMouseDown:y,onVideoMouseDown:M,onScreenMouseUp:v,drawPolyOutline:Re,redraw:P,draw:U,processFrame:X,clearSelection:E,deselect:W};return ze(`videoCanvas-${z}`,et),et}},Xn={"pointer-events":"none"},Jn=["id"],qn=["points"],Kn=["width","height"],Zn={class:"offset",style:{position:"absolute",top:"0px",left:"0px"}},Gn=["width","height"],Qn=["points"];function ea(e,t,n,o,a,l){return j(),Z("div",{ref:"containerRef",style:K([{height:"0px",width:"0px","pointer-events":"auto"},{zIndex:e.zIndex}])},[(j(),Z("svg",Xn,[C("clipPath",{id:`clipping-${n.instanceID}-${n.targetData.id}`},[C("polygon",{"pointer-events":"fill",points:e.currentPolygonMask?e.currentPolygonMaskStringScaled:null},null,8,qn)],8,Jn)])),C("div",{style:K({position:"absolute",top:e.top+"px",left:e.left+"px",clipPath:`url(#clipping-${n.instanceID}-${e.id})`}),onClick:t[0]||(t[0]=i=>{e.emitter.emit("clickVideoCanvas",i)}),onMousedown:t[1]||(t[1]=(...i)=>e.onVideoMouseDown&&e.onVideoMouseDown(...i))},[C("div",null,[C("canvas",{ref:"canvasRef",width:e.width,height:e.height,style:K({width:(e.width*e.scale.x).toPrecision(4)+"px",height:(e.height*e.scale.y).toPrecision(4)+"px",zIndex:e.zIndex})},null,12,Kn),C("div",{style:K(e.dragSelectStyle)},null,4),C("div",{class:"overlay",style:K([{display:n.overlay?"block":"none"},{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)"}])},null,4)]),C("div",Zn,[(j(!0),Z(Fe,null,Ne(e.currentTargets,i=>(j(),Ye(_t(e.getComponent(i)),{key:i.id,ref_for:!0,ref:d=>{d&&(e.componentRefs[i.id]=d)},targetData:i,vcTargetData:n.targetData,targets:n.targets,showHint:n.overlay,interactable:!(n.moveRegionMode||n.editRegionMode||n.frameLinkMode),onChangeState:e.changeState,onAddHistory:e.addHistory},null,8,["targetData","vcTargetData","targets","showHint","interactable","onChangeState","onAddHistory"]))),128))]),(j(!0),Z(Fe,null,Ne(n.targetData.cutouts,(i,d)=>(j(),Z("svg",{key:d,width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),style:K({width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),top:"0px",left:"0px",position:"absolute",fill:"black"}),"pointer-events":"none"},[C("polygon",{"pointer-events":"fill",points:e.utils.polyToPolyString(e.utils.scalePolygon(i.poly,e.scale),0,0)},null,8,Qn)],12,Gn))),128))],36)],4)}var ta=_e(Wn,[["render",ea]]);const na={name:"LoomInstance",components:{loomVideoCanvas:ta},props:{renderMode:String,videoTargetCache:{type:Object,default:{}},video_filename:{type:String,default:"video.mp4"},directory:String,moveRegionMode:Boolean,frameLinkMode:Boolean,editRegionMode:Boolean,overlay:Boolean,id:String,name:String},setup(e,t){const n=Oe("emitter"),{appConfig:o,linkedCanvases:a,appRefs:l,zip:i}=Oe("manager"),d=_(!1),c=_(null),w=_(null),O=_(null),Y=r=>{for(let f=0;f<b.value;++f)z(f,r)},z=(r,f)=>{const y={id:r,promises:[]};x.push(y),Ue(()=>{const M=V(oe[r],f);M?y.player=M:console.error("No Player!")})},V=(r,f)=>{const y=st.getPlayer(r);if(y)return y;const M={sources:[{src:"data:video/mp4;base64,"+btoa(f),type:"video/mp4"}],controls:!1,loadingSpinner:!1,controlBar:!1};return st(r,M,function(){this.on("click",function(v){v.preventDefault()})})},he=()=>d.value?Promise.resolve([w,o.value]):fetch(e.directory+".rva").then(r=>r.blob()).then(async r=>{const y=await new i.ZipReader(new i.BlobReader(r)).getEntries(),M=await y[1].getData(new i.BlobWriter);let v=new FileReader;return v.onloadend=W=>Y(W.target.result),v.readAsBinaryString(M),y[0].getData(new i.TextWriter)}).then(r=>JSON.parse(r)).catch(r=>null).then(r=>r==null?(console.error(`ERROR, IS_config not loaded
`),[null,null]):r.info.version!=Se.version?(console.error("ERROR, out of version IS_config file, run Recorder/convert.py"),[null,null]):(w.value=r,O.value=w.value.hasOwnProperty(c.value)?w.value[c.value]:w.value.original,d.value=!0,le.hidden={},e.videoTargetCache.hidden={},le.original=w.value.original.data,[w,o.value])),ue=r=>(c.value=`${r.value}_${r.renderMode}`,he().then(([f,y])=>{if(f===null||y===null)return;r.selected||(c.value="hidden"),me(c.value,r.renderMode),G(y,r.value,r.renderMode),Me(c.value),N.value=Object.values(ke.value).filter(v=>v.frame_no>0).sort((v,E)=>v.frame_no-E.frame_no)[0],Te(N.value.id);const M=Object.values(a.value.sets).find(v=>v.data.instance==e.id);if(M){const v=M.data;n.emit("changeVideoFrame",[v.instance,v.page,v.vcid,-1,v.frame,!1])}})),G=(r,f,y)=>{const M=`${f}_${y}`;if(!r||r[M]===void 0)return;const v=r[M],E=T.deepCopy(v);for(const W of Object.values(E))for(const L of Object.values(W)){L.processed=L.processed===void 0?Boolean(L.cutouts&&L.cutouts.length>0):L.processed,L.cutouts=L.cutouts||[];const ge=f,u=L.linkedFrames||[];for(const g of u){const p={mode:y,instance:ge,page:L.page,vcid:L.id};for(const P of g.frames){const U=Be(Pe({},p),{frame:P[0]}),X=Be(Pe({},g),{frame:P[1]}),Q=`${U.instance}_${U.page}_${U.vcid}_${U.frame}`,te=`${X.instance}_${X.page}_${X.vcid}_${X.frame}`;a.value.exists(Q)||a.value.add(Q,U),a.value.exists(te)||a.value.add(te,X),a.value.merge(Q,te)}}if(L.parentCanvas&&L.parentCanvas!="-1"){const g=be[L.parentCanvas];if(L.makeCutout&&g){g.targetData.cutouts=L.parentCanvas.cutouts||[];const p=L.region,P=Math.min(...p.map(k=>k.x)),U=Math.max(...p.map(k=>k.x)),X=Math.min(...p.map(k=>k.y)),Q=Math.max(...p.map(k=>k.y));g.targetData.cutouts.push({poly:p,width:U-P,height:Q-X,top:X,left:P,id:L.id})}}}for(let W in v)e.videoTargetCache[M][W]=v[W]},Me=r=>{e.videoTargetCache.hasOwnProperty(r)||I({processed:!1},r)},N=_(null),re=xe([]),$e=_(30),Te=(r,f=0)=>{const y=ke.value[r];if(y===void 0){console.error("Invalid state");return}ae(y.frame_no)},ae=r=>{N.value=Object.values(ke.value).find(f=>f.frame_no==r)},me=(r,f)=>{le.hasOwnProperty(r)||(w.value.hasOwnProperty(r)||(w.value[r]=Mn(w.value,le.original,f)),le[r]=w.value[r].data||{})},Ce=(r,f,y)=>{const M={id:r.id,videoCanvas:y,target:r,event:f};re.push(M),re.length>$e.value&&re.shift(),n.emit("runInteractionAnalysis",re)},de=_(30),b=_(3),x=xe([]),H=_(0),oe=xe({}),fe=(r,f,y,M=!0)=>{if(!y&&y!==0){be[f].draw(null,M);return}const v=x[H.value];if(!!v)return H.value=(H.value+1)%b.value,new Promise((E,W)=>{v.promises.push(E),v.inUse||E(E),setTimeout(()=>W(E),1e3)}).then(E=>{const W=v.promises.findIndex(L=>L==E);v.player.on("timeupdate",function L(){const ge=oe[v.id];!ge||(be[f]&&be[f].draw(ge,M),v.player.off("timeupdate",L),v.promises[W+1]&&v.promises[W+1](v.promises[W+1]),v.inUse=!1,v.promises.splice(W,1))}),v.inUse=!0,v.player.currentTime(y/de.value)}).catch(E=>{const W=v.promises.findIndex(L=>L==E);v.promises.splice(W,1),console.warn("frame took too long")})},Ie=(r,f)=>{const y=l[r.instance].renderAppMode;e.videoTargetCache[y][r.page][r.vcid].linkedFrames==null&&(e.videoTargetCache[y][r.page][r.vcid].linkedFrames=[]);const M=e.videoTargetCache[y][r.page][r.vcid].linkedFrames,v=M.find(E=>E.mode==f.mode&&E.page==f.page&&E.vcid==f.vcid);if(v!=null)v.frames=v.frames||[],v.frames.push([r.frame,f.frame]);else{const E=Pe({},f);r.instance!=f.instance&&(delete E.frame,E.frames=[[r.frame,f.frame]]),M.push(E)}},ke=F(()=>{const r=T.shallowCopy(le.original);delete r.mode;const f=T.shallowCopy(le[c.value]||{});return delete f.mode,T.deepMerge(r,f)}),be=xe({}),le=xe({}),ye=F(()=>{if(!N.value||!e.videoTargetCache[c.value])return[null,null];const r=Object.entries(e.videoTargetCache[c.value]);let f=null,y="-1";for(let M=N.value;f===null&&M&&M.id!=M.parent_id;M=ke.value[M.parent_id])if(!(typeof M.frame_no=="string"&&M.frame_no.includes("frameless"))){for(let v=0;v<r.length;++v)if(String(M.id)===r[v][0]){f=r[v][1],y=r[v][0];break}}return f===null&&(f=e.videoTargetCache[c.value]["-1"]),[y,f]}),B=F(()=>ye.value[1]),Re=F(()=>ye.value[0]),I=async(r={},f=void 0,y=!1)=>{f===void 0&&(f=c.value);let M="-1",v=0;e.videoTargetCache.hasOwnProperty(f)?(r.newPageFromRoot===!1?M=Re.value:M=String(N.value.id),v=M):e.videoTargetCache[f]={};const E=T.rectToPoly({x:0,y:0,width:w.value.info.window.width,height:w.value.info.window.height});(!e.videoTargetCache[f][M]||y)&&(e.videoTargetCache[f][M]={});const W=String(Object.keys(e.videoTargetCache[f][M]).length);return e.videoTargetCache[f][M][W]=Pe({page:M,id:W,current_state_id:v,region:E,top:0,left:0,makeCutout:!1,parentCanvas:!1,cutouts:[],startupFn:null,processed:!0},r),await Ue(()=>be[W])},Ae={IS_config:w,currentConfig:O,current_state:N,loaded:d,renderAppMode:c,transformedTargetCache:le,videoPlayers:x,interactionHistory:re,maxHistoryLength:$e,numVideoPlayers:b,lastUsedVideoPlayer:H,targets:ke,computeCurrentVideoTargets:ye,currentVideoTargets:B,currentPage:Re,setupVideo:V,load:he,init:ue,init_videoTargetCache:G,updateInteractionHistory:Ce,addInstanceLink:Ie,changeState:Te,changeStateWithFrameNo:ae,targetCacheModeChange:me,newVideoTarget:I,destroyVideoTarget:async(r,f,y)=>{delete e.videoTargetCache[r][f][y]},changeVideoFrame:fe,createNewVideoPlayer:z,videoCacheModeChange:Me,Up:r=>{r.zIndex++},Down:r=>{r.zIndex--},Delete:r=>{let f=null;r===null&&B.value!==null?f="-1":r&&(f=r.id),f!==null&&delete B.value[f]},paste:r=>{if(!r)return;const f=r.startupFn,y=T.deepCopy(r);for(y.startupFn=M=>{M.updateParentCurrentState=!1,f&&f(M)},y.id="0";B.value[y.id]!==void 0;)y.id=String(parseInt(y.id)+1);B.value[y.id]=y},loomVideoCanvasRefs:be,videoPlayerRefs:oe};return ze(`instance-${e.id}`,Ae),Ae}};function aa(e,t,n,o,a,l){const i=He("loom-video-canvas");return j(),Z("div",{id:"loom",style:K({height:e.IS_config?e.IS_config.info.window.height+"px":"0px",width:e.IS_config?e.IS_config.info.window.width+"px":"0px",position:"absolute","margin-left":"auto","margin-right":"auto","margin-top":"25px",left:0,right:0,"text-align":"center","pointer-events":"none"})},[(j(!0),Z(Fe,null,Ne(e.videoPlayers,(d,c)=>(j(),Z("video",{key:c,ref_for:!0,ref:w=>{w&&(e.videoPlayerRefs[d.id]=w)},style:K([{width:e.IS_config?e.IS_config.info.window.width+"px":"0px",height:e.IS_config?e.IS_config.info.window.height+"px":"0px"},{position:"absolute",top:"0px",left:"0px",visibility:"hidden"}]),class:"video-js",crossorigin:"anonymous"},null,4))),128)),(j(!0),Z(Fe,null,Ne(e.currentVideoTargets,d=>(j(),Ye(i,{key:`${e.renderAppMode}-${d.page}-${d.id}`,ref_for:!0,ref:c=>{c&&(e.loomVideoCanvasRefs[d.id]=c)},instanceID:n.id,targets:d.targets||e.targets,targetData:d,start_state_id:e.current_state.id,moveRegionMode:n.moveRegionMode,frameLinkMode:n.frameLinkMode,overlay:n.overlay,renderMode:n.renderMode,renderAppMode:e.renderAppMode,currentConfig:e.currentConfig,info:e.IS_config.info,editRegionMode:n.editRegionMode,onFrame_processed:()=>d.processed=!0},null,8,["instanceID","targets","targetData","start_state_id","moveRegionMode","frameLinkMode","overlay","renderMode","renderAppMode","currentConfig","info","editRegionMode","onFrame_processed"]))),128))],4)}var oa=_e(na,[["render",aa],["__scopeId","data-v-1e779ba5"]]);function ia(e,t=0,n=-1){this.rank=t,this.parent=n,this.data=e,this.children=[]}function ct(){this.sets={},this.nsets=0}ct.prototype={add(e=void 0,t=void 0){return e==null&&(e=this.sets.length),this.sets.hasOwnProperty(e)?null:(this.sets[e]=new ia(t),this.sets[e].children.push(e),++this.nsets,e)},find(e){return this.sets[e]?this.sets[e].parent==-1?e:(this.sets[e].parent=this.find(this.sets[e].parent),this.sets[e].parent):null},transferChildren(e,t){const n=this.sets[e],o=this.sets[t];o.children=o.children.concat(n.children),n.children=[]},merge(e,t){if(e=this.find(e),t=this.find(t),e==null||t==null)return null;if(e!=t){const n=this.sets[e],o=this.sets[t];n.rank>o.rank?(o.parent=e,this.transferChildren(t,e)):n.rank<o.rank?(n.parent=t,this.transferChildren(e,t)):(o.parent=e,++n.rank,this.transferChildren(t,e)),--this.nsets}return this.find(e)},of(e){return this.sets[this.find(e)].children.map(t=>this.sets[t].data)},connected(e,t){return this.find(e)===this.find(t)},at(e){return this.sets[e].data},exists(e){return this.sets.hasOwnProperty(e)},size(){return this.nsets}};kt({useWebWorkers:!1});const sa={components:{loomInstance:oa},props:["directory","modifier_directory"],setup(e,t){const n=Oe("emitter"),o=_(null),a=_(!1),l=_(!1),i=_(!1),d=_(!1),c=_(!1),w=_(null),O=_(null),Y=u=>{I.value=u,ie()},z=()=>{B[b.value.instanceID]&&B[b.value.instanceID].Up(b.value)},V=()=>{B[b.value.instanceID]&&B[b.value.instanceID].Down(b.value)},he=()=>{B[b.value.instanceID]&&B[b.value.instanceID].Delete(b.value)},ue=()=>{O.value=b.value},G=()=>{ue(),he()},Me=()=>{const u=O.value;ue(),N(),O.value=u},N=()=>{if(B[O.value.instanceID]){const u=T.deepCopy(O.value.targetData);u.makeCutout=!1,B[O.value.instanceID].paste(u)}},re=()=>{let u="None";se.value.startState&&se.value.startState.saveName&&(u=se.value.startState.saveName);let g=prompt(`Enter name to save config as: (default: ${u})`);if(!g){if(!u||u=="None")return;g=u}const p=new Set(JSON.parse(localStorage.getItem("saveNames")))||new Set;p.has(g)&&!confirm("Name already taken")||(p.add(g),se.value.startState={saveName:g,appMode:I.value},Ue(()=>{try{localStorage.setItem("saveNames",JSON.stringify([...p])),localStorage.setItem(g,JSON.stringify(se.value))}catch(P){alert(`Could not save to localStorage: ${String(P)}`),console.error(P)}}))},$e=u=>{if(le.value===null)return!1;let g=new Set(ye.value.map(U=>U.split(".")[0])),p=localStorage.getItem("saveNames");if(p&&(p=JSON.parse(p),p.forEach(U=>g.add(U))),!g)return alert("No files to load"),!1;g=Array.from(g);function P(U){if(se.value=U,se.value.startState&&se.value.startState.appMode){const X=se.value.startState.appMode;X.forEach(Q=>{const te=e.directory+"/"+Q,k=te.split("/").filter(ve=>ve!="").slice(-1)[0].replaceAll(" ","_");Re.push({directory:te,label:k.charAt(0).toUpperCase()+k.slice(1),minLabel:(k.charAt(0).toUpperCase()+k.slice(1)).substr(0,4)+"...",value:k})}),A.value="desktop",I.value=X.map(Q=>Q.split().join("_"))}Ue(ie)}if(u===void 0&&(u=prompt(`Enter file (blank to upload)
 Available names: `+g.join(", "))),u==="")Te().then(U=>{const X=new FileReader;X.onload=Q=>{P(JSON.parse(Q.target.result)),re()},X.readAsText(U)});else if(g.some(U=>U==u)){const U=g.indexOf(u),X=le.value[U];return P(X||JSON.parse(localStorage.getItem(u))),!0}else return alert("File does not exist"),!1};function Te(){return new Promise(u=>{let g=document.createElement("input");g.type="file",g.onchange=p=>{let P=Array.from(g.files);u(P[0])},g.click()})}const ae=_([]),me=([u,g])=>{ae.value[u]=g},Ce=u=>{delete ae[u]},de=u=>T.getComponentFromPoint(ge,u.x,u.y),b=_(null),x=_(new ct),H=async(u=null,g=void 0,p=!0)=>{if(B[b.value.instanceID])return await B[b.value.instanceID].newVideoTarget(u,g,p)},oe=u=>{B[u.instanceID].destroyVideoTarget(u.mode,u.page,u.id)},fe=()=>{l.value=!0,w.value.cutSelectedRegion()},Ie=(u,g,p,P,U,X,Q=!1)=>{const te=[];if(!(P==U&&!Q))return x.value.exists(`${u}_${g}_${p}_${U}`)?x.value.of(`${u}_${g}_${p}_${U}`).forEach(k=>{k.componentID===void 0&&B[k.instance]&&(B[k.instance].changeVideoFrame(k.page,k.vcid,k.frame,X),te.push({instance:k.instance,page:k.page,vcid:k.vcid}))}):B[u]&&(B[u].changeVideoFrame(g,p,U,X),te.push({instance:u,page:g,vcid:p})),te},ke=(u,g)=>{let p=null;return g==null?p={instance:u.instanceID,page:u.page,vcid:u.id,frame:u.lastFrame}:p={instance:u.instanceID,page:u.page,vcid:u.id,frame:g.frame,componentID:g.componentID},p},be=(u,g)=>{let p,P;P=`${u.instance}_${u.page}_${u.vcid}_${u.frame}`,p=`${g.instance}_${g.page}_${g.vcid}_${g.frame}`,x.value.exists(P)||x.value.add(P,u),x.value.exists(p)||x.value.add(p,g),x.value.merge(P,p),b.value.instanceRef.addInstanceLink(u,g)},le=_(null),ye=_(null),B=xe({}),Re=xe([]),I=_(null),A=_(null),se=_({}),ie=()=>{if(!I.value)return;Re.map(g=>Pe({selected:I.value.includes(g.value)},g)).forEach(async g=>{const p=Be(Pe({},g),{renderMode:A.value});B.hasOwnProperty(g.value)&&await B[g.value].init(p)})},we=function(u){return fetch("https://api.github.com/repos/branson2015/DeRe_Apps/git/trees/main?recursive=1").then(p=>p.json()).then(p=>{const P=p.tree.map(k=>k.path),U=P.filter(k=>k.substr(0,"demos/demos/".length)==="demos/demos/").map(k=>k.substr("demos/demos/".length)),X=P.filter(k=>k.substr(0,"RVA/".length)==="RVA/").map(k=>k.substr("RVA/".length));ye.value=U;const Q=ye.value.map(k=>fetch(`${e.modifier_directory}/${k}`).then(ve=>ve.json())),te=X.map(k=>{const ve=k.slice(0,-4);return ye.value.push(ve),{hidden:{},[ve]:{},startState:{saveName:ve,appMode:[ve],current_state:0}}});return Promise.all(Q).then(k=>{le.value=[...k,...te]})})},De=u=>{a.value&&H()},Ae=u=>{l.value&&c&&fe()},r=u=>{a.value&&b&&G()},f=u=>{a.value&&b&&ue()},y=u=>{a.value&&b&&Me()},M=u=>{a.value&&O&&N()},v=u=>{a.value&&b&&he()},E=u=>{a.value&&b&&z()},W=u=>{a.value&&b&&V()},L=u=>{A.value=u,ie()};Ze(()=>{window.app=ge,n.on("regionExists",u=>{c.value=u.exists,w.value=u.origin}),n.on("selectVideoCanvas",u=>{b.value=u}),n.on("changeVideoFrame",u=>Ie(...u)),n.on("addComponent",me),n.on("removeComponet",Ce),n.on("newCanvasClicked",De),n.on("newRegionClicked",Ae),n.on("cutRegionClicked",r),n.on("copyRegionClicked",f),n.on("duplicateRegionClicked",y),n.on("pasteRegionClicked",M),n.on("deleteRegionClicked",v),n.on("ZupClicked",E),n.on("ZdownClicked",W),n.on("saveVideoCanvasState",re),n.on("loadVideoCanvasState",$e),n.on("renderModeChange",L),n.on("call",u=>{const g=u.shift();return ge[g](...u)}),n.on("do",u=>u(ge)),n.on("getManager",()=>ge),we(e.modifier_directory).then(()=>{n.emit("ready")})});const ge={getModifierFiles:we,appModes:Re,appMode:I,renderMode:A,moveRegionMode:a,hintMode:d,editRegionMode:l,frameLinkMode:i,regionExists:c,regionOrigin:w,currVideoCanvasSelected:b,pasteBin:O,linkedCanvases:x,appConfig:se,activeComponents:ae,init:ie,newVideoTarget:H,destroyVideoTarget:oe,cutRegion:fe,renderModeChange:L,onAppModeChange:Y,saveVideoCanvasState:re,loadVideoCanvasState:$e,createLinkEntry:ke,createLink:be,changeVideoFrame:Ie,Up:z,Down:V,Delete:he,copy:ue,cut:G,duplicate:Me,paste:N,componentClicked:de,addComponent:me,removeComponent:Ce,managerRef:o,appRefs:B,utils:T,zip:wt,emitter:n};return ze("manager",ge),ge}},ra={ref:"managerRef"},la={style:{position:"relative"}};function ca(e,t,n,o,a,l){const i=He("loom-instance");return j(),Z("div",ra,[C("div",la,[(j(!0),Z(Fe,null,Ne(e.appModes,(d,c)=>(j(),Ye(i,{key:String(c),id:d.value,ref_for:!0,ref:w=>{w&&(e.appRefs[d.value]=w)},name:d.value,directory:d.directory,videoTargetCache:e.appConfig,moveRegionMode:e.moveRegionMode,editRegionMode:e.editRegionMode,frameLinkMode:e.frameLinkMode,overlay:e.hintMode,renderMode:e.renderMode},null,8,["id","name","directory","videoTargetCache","moveRegionMode","editRegionMode","frameLinkMode","overlay","renderMode"]))),128))])],512)}var ua=_e(sa,[["render",ca]]);const da={components:{Multiselect:Dt},props:[],setup(e,t){const n=Oe("emitter");let o=_(null);const a=xe({linkMode:"selectable",firstLink:null}),l=F(()=>({none:{color:"grey",cursor:"default"},selectable:{color:"white",cursor:"pointer"},linkingFrom:{color:"green",cursor:"pointer"},linkingTo:{color:"red",cursor:"pointer"}})[a.linkMode]),i=xe({mapLinkMode:"selectable",firstLink:null,mapComponent:null}),d=async b=>{const x=()=>{i.mapComponent!=null&&o.value.destroyVideoTarget(i.mapComponent.$parent),i.mapLinkMode="selectable",i.firstLink=null,i.mapComponent=null};if(i.mapLinkMode=="selectable"){if(i.mapComponent!=null)return;i.mapComponent=(await c()).componentRefs["0"],i.mapLinkMode="linkingFrom"}else if(i.mapLinkMode=="linkingFrom")i.firstLink=await i.mapComponent.getMapping(),i.mapLinkMode="linkingTo";else if(i.mapLinkMode=="linkingTo"){const H=await i.mapComponent.getMapping(),oe=i.firstLink;Object.keys(H).forEach(fe=>{oe.hasOwnProperty(fe)&&o.value.createLink(oe[fe],H[fe])}),x()}},c=async()=>{const b=550,x=315;return await o.value.newVideoTarget({reshapeable:!1,resizeable:!0,region:T.rectToPoly({x:0,y:0,width:b,height:x}),width:b,height:x,targets:[{actor:"USA",id:"0",important:!0}],startupFn:H=>{H.lastFrame=0,delete H.targetData.startupFn},drawImage:!1,newPageFromRoot:!1,current_state_id:"0"},void 0,!1)},w=F(()=>({cursor:"pointer",color:{selectable:"white",linkingFrom:"green",linkingTo:"red"}[i.mapLinkMode]})),O=()=>{a.linkMode=a.linkMode=="selectable"?"linkingFrom":"selectable"},Y=b=>{a.linkMode!=="selectable"&&Ue(()=>{const x=n.emit("call",["componentClicked",b]);a.linkMode==="linkingFrom"?(n.emit("do",H=>{a.firstLink=H.createLinkEntry(H.currVideoCanvasSelected.value,x)}),a.linkMode="linkingTo"):a.linkMode==="linkingTo"&&(n.emit("do",H=>{const oe=H.createLinkEntry(H.currVideoCanvasSelected.value,x);H.createLink(a.firstLink,oe)}),a.linkMode="selectable")})},z=F(()=>o.value===null?!1:o.value.moveRegionMode),V=F(()=>o.value===null?!1:o.value.editRegionMode),he={moveRegionMode:"moveRegion",editRegionMode:"editRegion",frameLinkMode:"frameLink",hintMode:"hint"},ue=b=>{for(const x in he){const H=$(`#${he[x]}`);if(x===b){let oe;n.emit("do",fe=>{fe[x].value=!fe[x].value,oe=fe[x].value}),H.css("display",oe?"flex":"none");continue}n.emit("do",oe=>{oe[x].value=!1}),H.css("display","none")}},G=_(!1),Me=()=>{ue("moveRegionMode")},N=()=>{ue("editRegionMode")},re=()=>{ue("frameLinkMode")},$e=()=>{ue("hintMode")},Te=(b,x)=>{n.emit(b,x)},ae=xe([]),me=_(null),Ce=_(null);Ze(()=>{n.on("clickVideoCanvas",Y),n.on("ready",()=>{o.value=n.emit("getManager")[0];let b="tableau";window.location.hash!==""&&(b=window.location.hash.substring(1)),n.emit("loadVideoCanvasState",b)}),$(".tool-change").css("display","none")});const de={manager:o,emitEvent:Te,linkData:a,mapLinkData:i,linkVideoCanvasStyle:l,mapLinkClicked:d,addMap:c,mapLinkStyle:w,linkClicked:O,videoCanvasClicked:Y,renderModes:ae,renderModeRef:me,moveRegionMode:z,editRegionMode:V,linkFrameToggleRef:Ce,regionMoveToggled:Me,regionEditToggled:N,frameLinkEditToggled:re,hintToggled:$e,displayUI:G};return ze("UI",de),de}},fa={class:"tool-column",style:{height:"20vh"}},ga={class:"tool-row"},ha={class:"loadSave"},ma={class:"loadSave"},va={class:"tool-column",style:{height:"60vh"}},pa=C("span",{class:"text"},"Move Region",-1),ya=[pa],xa=C("span",{class:"text"},"Region Edit",-1),Ma=[xa],Ca=C("span",{style:{"font-size":"29px"}}," Frame Linking ",-1),ba=[Ca],_a=C("span",null,"Hints",-1),ka=[_a],wa={class:"middle"},Da={class:"tool-column tool-change",id:"moveRegion"},Sa={class:"tool-column tool-change",id:"editRegion"},$a={class:"tool-column tool-change",id:"frameLink"},Ia=C("ul",{class:"tool-column tool-change",id:"hint"},null,-1);function Ra(e,t,n,o,a,l){const i=He("font-awesome-icon");return j(),Z("div",{class:"grid-container",style:K({"grid-template-rows":e.displayUI?"60px 1fr 0px":"0px 1fr 0px","grid-template-columns":e.displayUI?"240px 1fr 120px":"0px 1fr 0px"})},[C("div",{class:"header",style:K({display:e.displayUI?"block":"none"})},ot(e.manager?e.manager.appMode[0]:""),5),C("div",{class:"left",style:K({display:e.displayUI?"block":"none"})},[C("div",fa,[C("ul",ga,[C("li",ha,[ce(i,{icon:"save",class:"tool-item-left",style:{height:"50px",padding:"5px",display:"block"},onClick:t[0]||(t[0]=()=>e.emitEvent("saveVideoCanvasState"))})]),C("li",ma,[ce(i,{icon:"file",class:"tool-item-left",style:{height:"50px",padding:"5px",display:"block"},onClick:t[1]||(t[1]=()=>e.emitEvent("loadVideoCanvasState",void 0))})])])]),C("ul",va,[C("li",{class:pe(["tool-item-left",e.manager&&e.manager.moveRegionMode?"activeInput":"inactiveInput"]),onClick:t[2]||(t[2]=(...d)=>e.regionMoveToggled&&e.regionMoveToggled(...d)),style:{cursor:"pointer"},ref:"moveRegionToggleRef"},ya,2),C("li",{class:pe(["tool-item-left",e.manager&&e.manager.editRegionMode?"activeInput":"inactiveInput"]),ref:"editRegionToggleRef",style:{cursor:"pointer"},onClick:t[3]||(t[3]=(...d)=>e.regionEditToggled&&e.regionEditToggled(...d))},Ma,2),C("li",{class:pe(["tool-item-left",e.manager&&e.manager.frameLinkMode?"activeInput":"inactiveInput"]),ref:"linkFrameToggleRef",style:{cursor:"pointer"},onClick:t[4]||(t[4]=(...d)=>e.frameLinkEditToggled&&e.frameLinkEditToggled(...d))},ba,2),C("li",{class:pe(["tool-item-left",e.manager&&e.manager.hintMode?"activeInput":"inactiveInput"]),ref:"helpToggleRef",style:{cursor:"pointer"},onClick:t[5]||(t[5]=(...d)=>e.hintToggled&&e.hintToggled(...d))},ka,2)])],4),C("div",wa,[St(e.$slots,"default")]),C("div",{class:"right",style:K({display:e.displayUI?"block":"none"})},[C("ul",Da,[C("li",{class:pe(["tool-item",e.moveRegionMode?"activeInput":"inactiveInput"]),onClick:t[6]||(t[6]=()=>e.emitEvent("newCanvasClicked"))},[ce(i,{icon:"plus-square"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[7]||(t[7]=()=>e.emitEvent("cutRegionClicked"))},[ce(i,{icon:"cut"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[8]||(t[8]=()=>e.emitEvent("copyRegionClicked"))},[ce(i,{icon:"copy"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[9]||(t[9]=()=>e.emitEvent("duplicateRegionClicked"))},[ce(i,{icon:"clone"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.pasteBin?"activeInput":"inactiveInput"]),onClick:t[10]||(t[10]=()=>e.emitEvent("pasteRegionClicked"))},[ce(i,{icon:"paste"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[11]||(t[11]=()=>e.emitEvent("deleteRegionClicked"))},[ce(i,{icon:"trash"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[12]||(t[12]=()=>e.emitEvent("ZupClicked"))},[ce(i,{icon:"arrow-up"})],2),C("li",{class:pe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[13]||(t[13]=()=>e.emitEvent("ZdownClicked"))},[ce(i,{icon:"arrow-down"})],2)]),C("ul",Sa,[C("li",{class:pe(["tool-item",e.editRegionMode&&e.manager.regionExists?"activeInput":"inactiveInput"]),onClick:t[14]||(t[14]=d=>e.emitEvent("newRegionClicked"))},[ce(i,{icon:"border-none"})],2)]),C("ul",$a,[C("li",{class:"tool-item",style:K(e.linkVideoCanvasStyle),onClick:t[15]||(t[15]=(...d)=>e.linkClicked&&e.linkClicked(...d))},[ce(i,{icon:"link",style:K({color:{linkingFrom:"green",linkingTo:"red"}[e.linkData.linkMode]||"white"})},null,8,["style"])],4),C("li",{class:"tool-item",style:K(e.mapLinkStyle),onClick:t[16]||(t[16]=(...d)=>e.mapLinkClicked&&e.mapLinkClicked(...d))},[ce(i,{icon:"map"})],4)]),Ia],4)],4)}var Ta=_e(da,[["render",Ra]]);const Pa={name:"MainPage",components:{loomManager:ua,loomUI:Ta},data:function(){return{directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/RVA",modifier_directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/demos/demos"}}},Oa={id:"container"};function Aa(e,t,n,o,a,l){const i=He("loom-manager"),d=He("loom-u-i");return j(),Z("div",Oa,[ce(d,null,{default:$t(()=>[ce(i,{directory:e.directory,modifier_directory:e.modifier_directory},null,8,["directory","modifier_directory"])]),_:1})])}var La=_e(Pa,[["render",Aa],["__scopeId","data-v-04d62d1f"]]);const Va={components:{MainPage:La},created(){window.addEventListener("mousemove",e=>{document.body.style.cursor="default",this.emitter.emit("mousemove",e)}),window.addEventListener("mouseup",e=>{document.body.style.cursor="default",this.emitter.emit("mouseup",e)}),window.addEventListener("mousedown",e=>{this.emitter.emit("mousedown",e)})}};function Ea(e,t,n,o,a,l){const i=He("main-page");return j(),Ye(i)}var Fa=_e(Va,[["render",Ea]]);It.add(Rt,Tt,Pt,Ot,At,Lt,Vt,Et,Ft,Nt,Ht,Bt,Ut,jt);const Na=e=>{const t=Wt(e);return t.emitAsync=async function(n,o){let a=this.all.get(n);if(a)for(const l of a)await l(o);if(a=this.all.get("*"),a)for(const l of a)await l(n,o)},t.emit=function(n,o){let a=[],l=this.all.get(n);return l&&(a=a.concat(l.map(i=>i(o)))),l=this.all.get("*"),l&&(a=a.concat(l.map(i=>i(o)))),a},t},ut=Na(),Xe=zt(Fa);Xe.config.globalProperties.emitter=ut;Xe.provide("emitter",ut);Xe.component("font-awesome-icon",Yt);Xe.mount("#app");
