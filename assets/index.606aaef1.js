var mt=Object.defineProperty,vt=Object.defineProperties;var pt=Object.getOwnPropertyDescriptors;var at=Object.getOwnPropertySymbols;var yt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var ot=(e,t,n)=>t in e?mt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Oe=(e,t)=>{for(var n in t||(t={}))yt.call(t,n)&&ot(e,n,t[n]);if(at)for(var n of at(t))xt.call(t,n)&&ot(e,n,t[n]);return e},je=(e,t)=>vt(e,pt(t));import{$ as it,o as j,c as G,n as Z,a as C,m as qe,t as Ge,b as Qe,F as Ne,r as He,d as st,i as Le,g as Mt,e as b,f as F,h as Me,j as Ct,w as rt,k as et,l as _t,p as We,q as Xe,s as bt,u as Be,v as ze,x as lt,y as kt,z as wt,P as Dt,A as de,B as xe,C as St,D as $t,E as Rt,G as It,H as Tt,I as Pt,J as At,K as Ot,L as Lt,M as Vt,N as Et,O as Ft,Q as Nt,R as Ht,S as Bt,T as Ut,U as jt,V as zt,W as Yt,X as Wt}from"./vendor.23db5a8c.js";const Xt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}};Xt();const Jt="0.0.7",Kt={mappings:{loomHover:"loomButton"},spatialTransform:{horizontal_buttons_to_dropdown:!0,vertical_buttons_to_dropdown:!0}};var $e={version:Jt,mobile:Kt};function Zt(e,t){return e?ut(t,o=>o.hide!==!0&&o.id!="-1"&&(tt(e,o)||e.deactivateOnTransition!==!0&&ct(t,o,e)||o.parent_id=="-1")||o.important):{}}function tt(e,t){return e&&e.hasOwnProperty("children")?Object.keys(e.children).includes(String(t.id)):!1}function ct(e,t,n){return tt(e[n.parent_id],t)}function ut(e,t){const n={};return Object.keys(e).filter(o=>t(e[o])).forEach(o=>n[o]=e[o]),n}function qt(e){const t=[];return Object.keys(e).forEach(n=>t[n]=e[n]),t}function Gt(e){const t={};return e.forEach((n,o)=>t[o]=n),t}function Qt(e){const t={};return Object.entries(e).forEach(([n,o])=>{t[n]=o}),t}function en(e,t=void 0){const n={};return Object.keys(e).forEach(o=>{e[o]!==Object(e[o])?n[o]=e[o]:t!==void 0&&(n[o]=t)}),n}function Ye(e){if(typeof e=="object"&&e!==null)if(e.constructor===Array){const t=[];return e.forEach(n=>{t.push(Ye(n))}),t}else{const t={};return Object.entries(e).forEach(([n,o])=>{t[n]=Ye(o)}),t}return e}function tn(e,t){const n=Ye(e),o=Ye(t);return function a(l,i){let d={};return[...new Set(Object.keys(l).concat(Object.keys(i)))].forEach(c=>{i[c]===null||(i[c]===void 0||Object.keys(i[c]).length==0||l[c]!==Object(l[c])||i[c]!==Object(i[c])?d[c]=i[c]!==void 0?i[c]:l[c]:d[c]=a(l[c],i[c]))}),d}(n,o)}function nn(e,t){const n=[];for(let o=0;o<e.rows;o++)for(let a=0;a<e.cols;a++){const l=Array.from(e.ucharPtr(o,a)).slice(0,3),i=Array.from(t.ucharPtr(o,a));l.map((c,k)=>[c,i[k]]).forEach(c=>n.push(Math.abs(c[1]-c[0])))}return n}function an(e,t){return e.map(n=>({x:n.x*t.x,y:n.y*t.y}))}function on(e){let t="";t+=`M ${e[0].x} ${e[0].y} `;for(let n=1;n<e.length;++n)t+=`L ${e[n].x} ${e[n].y} `;return t+=`L ${e[0].x} ${e[0].y} `,new Path2D(t)}function sn(e,t,n){t===void 0&&(t=Math.min(...e.map(a=>a.x))),n===void 0&&(n=Math.min(...e.map(a=>a.y)));let o="";return e.forEach((a,l)=>{o+=(a.x-t).toPrecision(4)+","+(a.y-n).toPrecision(4),l!==e.length-1&&(o+=" ")}),o}function rn(e){return[{x:e.x,y:e.y},{x:e.x+e.width,y:e.y},{x:e.x+e.width,y:e.y+e.height},{x:e.x,y:e.y+e.height}]}function ln(e){let t=1/0,n=0,o=1/0,a=0;return e.forEach(l=>{t=Math.min(t,l.x),n=Math.max(n,l.x),o=Math.min(o,l.y),a=Math.max(a,l.y)}),{xmin:t,xmax:n,ymin:o,ymax:a}}function cn(e,t,n){return Math.min(Math.max(t,e),n)}function un(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function dn(e){return new Promise(t=>setTimeout(t,e))}function fn(e,t,n=0){let o={};return function(){o[n]||(e.apply(this,arguments),o[n]=!0,setTimeout(function(){delete o[n]},t))}}function hn(e,t,n){const a=document.elementsFromPoint(t,n).find(d=>d.nodeName=="polygon");if(a===void 0)return null;if(a.isPointInFill){const d=a.getBoundingClientRect(),c=a.parentElement.createSVGPoint();if(c.x=t-d.left,c.y=n-d.top,!a.isPointInFill(c))return null}const l=a.parentElement.parentElement.id,i=e.activeComponents.value[l];return i===void 0||!i.isLoomComponent?null:i}var T={currentTargets:Zt,isChild:tt,isSibling:ct,objectFilter:ut,arrayToObject:Gt,ObjectToArray:qt,shallowCopy:Qt,shallowCopyPrimitivesOnly:en,deepCopy:Ye,deepMerge:tn,absdiff:nn,scalePolygon:an,polyToPath2D:on,polyToPolyString:sn,rectToPoly:rn,boundingBox:ln,bound:cn,dist:un,sleep:dn,throttle:fn,getComponentFromPoint:hn};function gn(e,t){if(t.children===void 0)return[];let n=Object.keys(t.children).map(d=>e[d]).filter(d=>Object.keys(d.shape.points).length==4).map(d=>[d]);n.forEach((d,c)=>d[0].group=c);const o=5,a=20,l=5,i=5;for(let d=1;d<n.length;++d)for(let c=0;c<d;++c){const k=n[c].length;for(let P=0;P<k;++P){const W=n[d][0],z=n[c][P];if(!(!W||!z)&&($e.mobile&&$e.mobile.spatialTransform&&$e.mobile.spatialTransform.horizontal_buttons_to_dropdown&&Math.abs(W.shape.dimensions.centerY-z.shape.dimensions.centerY)<=o&&Math.abs(W.shape.dimensions.min_x-z.shape.dimensions.max_x)<=a||$e.mobile&&$e.mobile.spatialTransform&&$e.mobile.spatialTransform.vertical_buttons_to_dropdown&&Math.abs(W.shape.dimensions.min_y-z.shape.dimensions.max_y)<=i&&Math.abs(W.shape.dimensions.centerX-z.shape.dimensions.centerY<=l))){const V=W.group;n[V].forEach(ve=>ve.group=c),n[c]=n[c].concat(n[V]),n[V]=[]}}}return n=n.filter(d=>d.length>1),n}function mn(e){const t=(e.max_x-e.min_x)/2,n=Math.max(Math.ceil(Math.pow(t,2/3)),5),o=[];for(let l=0;l<n;++l){const i=2*Math.PI*l/n;o.push({x:Math.sin(i)*t+e.min_x+(e.max_x-e.min_x)/2,y:Math.cos(i)*t+e.min_y+(e.max_y-e.min_y)/2})}const a=je(Oe({},e),{min_y:e.centerY-t,max_y:e.centerY+t});return[o,a]}function vn(e,t,n){gn(e,e[n]).forEach(a=>{let l=1/0,i=0,d=1/0,c=0;const k=a.map(()=>({}));for(const V in k)k[V]={},l=Math.min(a[V].shape.dimensions.min_x,l),i=Math.max(a[V].shape.dimensions.max_x,i),d=Math.min(a[V].shape.dimensions.min_y,d),c=Math.max(a[V].shape.dimensions.max_y,c);const P=Object.values(a).map(V=>V.id),W=P.join(),z={actor:"dropdown",type:"linear",name:a.map(V=>V.name).join("-"),id:W,parent:e[n].name||"root",parent_id:e[n].id!==void 0?e[n].id:"-1",children:k,frame_no:-1,child_visit_counter:Object.keys(k).length,shape:{type:"poly",points:{0:{x:l,y:d},1:{x:i,y:d},2:{x:i,y:c},3:{x:l,y:c}},dimensions:{min_x:l,max_x:i,min_y:d,max_y:c}}};P.forEach(V=>t[V]={hide:!0,parent_id:z.id,parent:z.name}),t[W]=z})}function pn(e,t,n){["button","hover"].includes(e[n].actor)&&e[n].shape.points.length==4&&([points,dimensions]=mn(e[n].shape.dimensions),t[n].shape={points,dimensions})}function yn(e,t){const n=[];for(n.push("-1");n.length;){const o=n.shift();t[o]!==null&&(vn(e,t,o),pn(e,t,o),e[o].hasOwnProperty("children")&&t[o]!==null&&n.push(...Object.keys(e[o].children)))}}function xn(e){const t={mode:"mobile"};return yn(T.shallowCopy(e),t),t}function Mn(e,t,n){if(n==e.info.mode)return{};let o={};switch(n){case"mobile":o.info={mode:"mobile"},o.data=xn(t);break}return o}const Je={props:["parent","vcTargetData","targetData","showHint","interactable","current_state","targets"],emits:["changeState","addHistory"],name:"loomComponent",data:function(){return{isLoomComponent:!0,points:null,eventData:{}}},computed:{renderMode(){return this.$parent.renderMode},instanceID(){return this.$parent.instanceID},page(){return this.$parent.page},vcid(){return this.$parent.id},id(){return this.targetData.id},scale(){return this.vcTargetData.scale||{x:1,y:1}},frame(){return this.targetData.frame_no+1},componentID(){return`${this.instanceID}-${this.page}-${this.vcid}-${this.id}`},calcHintStyle(){return{fill:"rgba(246, 230, 80, 0.7)",stroke:"rgba(250, 240, 80, 0.8)","stroke-width":"2"}},calcStyle(){const e=this.targetData;let t="";const n=T.ObjectToArray(e.shape.points),o=T.scalePolygon(n,this.scale),a=e.shape.dimensions.min_x*this.scale.x,l=e.shape.dimensions.min_y*this.scale.y,i=e.shape.dimensions.max_x*this.scale.x,d=e.shape.dimensions.max_y*this.scale.y,c=o.length;return o.forEach((P,W)=>{t+=`${P.x-a},${P.y-l}`,W!==c-1&&(t+=" ")}),this.points=t,{position:"absolute",top:`${parseInt(l)}px`,left:`${parseInt(a)}px`,width:`${parseInt(i-a)}px`,height:`${parseInt(d-l)}px`}}},mounted(){this.$refs.target&&(this.$refs.target.style.display=this.interactable?"block":"none"),this.emitter.emit("addComponent",[this.componentID,this])},beforeUnmount(){this.emitter.emit("removeComponent",this.componentID)},watch:{interactable:function(e){this.$refs.target&&(this.$refs.target.style.display=e?"block":"none")}}};var ke=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n};const Cn={name:"loomBrushingBox",mixins:[Je],data:function(){return{brushing:{state:!1,start_x:0,start_y:0,end_x:0,end_y:0}}},computed:{brushingBoxStyle:function(){return{position:"absolute",visibility:this.brushing.state?"visible":"hidden",top:this.brushing.start_y+"px",left:this.brushing.start_x+"px",width:this.brushing.end_x-this.brushing.start_x+"px",height:this.brushing.end_y-this.brushing.start_y+"px"}}},mounted:function(){this.eventData.mousedown=function(e){let t=e.currentTarget;var n=it(t).offset(),o=e.pageX-n.left,a=e.pageY-n.top;this.brushing.state=!0,this.brushing.start_x=this.brushing.end_x=o,this.brushing.start_y=this.brushing.end_y=a,this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseup=function(e){this.brushing.state=!1}.bind(this),this.eventData.mousemove=function(e){if(this.brushing.state==!1)return;const t=e.currentTarget,n=it(t).offset(),o=this.targetData.shape.dimensions.max_x-this.targetData.shape.dimensions.min_x,a=this.targetData.shape.dimensions.max_y-this.targetData.shape.dimensions.min_y;this.brushing.end_x=e.pageX-n.left,this.brushing.end_y=e.pageY-n.top;const l=6,i=o/l,d=a/l,c=Math.round(this.brushing.start_x/i),k=Math.round(this.brushing.start_y/d),P=Math.round((this.brushing.end_x-this.brushing.start_x)/i),z=(Math.round((this.brushing.end_y-this.brushing.start_y)/d)-1)*l**0+P*l**1+k*l**2+c*l**3;this.$emit("changeState",this.targetData.id,z)}.bind(this)}},_n=["id"],bn=["width","height"],kn=["points"];function wn(e,t,n,o,a,l){return j(),G("div",{ref:"target",id:e.componentID,style:Z(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:Z([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",qe({ref:"polygon"},Ge(e.eventData),{points:e.points,style:{cursor:"cell"}}),null,16,kn)],12,bn)):Qe("",!0),C("div",{id:"brushing-box",ref:"brushing-box",style:Z(l.brushingBoxStyle)},null,4)],12,_n)}var Dn=ke(Cn,[["render",wn],["__scopeId","data-v-8b1e5c1e"]]);const Sn={name:"loomButton",mixins:[Je],mounted:function(){this.eventData.click=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this)}},$n=["id"],Rn=["width","height"],In=["points"];function Tn(e,t,n,o,a,l){return j(),G("div",{ref:"target",id:e.componentID,style:Z(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:Z([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",qe({ref:"polygon"},Ge(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,In)],12,Rn)):Qe("",!0)],12,$n)}var Pn=ke(Sn,[["render",Tn]]);const An={name:"loomHover",mixins:[Je],emits:["onmouseleave"],mounted:function(){this.eventData.mouseover=function(e){this.$emit("changeState",this.targetData.id),this.$emit("addHistory",this.targetData,e)}.bind(this),this.eventData.mouseleave=function(e){this.$emit("onmouseleave")}.bind(this)}},On=["id"],Ln=["width","height"],Vn=["points"];function En(e,t,n,o,a,l){return j(),G("div",{ref:"target",id:e.componentID,style:Z(e.calcStyle)},[e.targetData.shape.type=="poly"?(j(),G("svg",{key:0,width:e.calcStyle.width,height:e.calcStyle.height,style:Z([{fill:"transparent","stroke-width":"5"},e.showHint?e.calcHintStyle:{}])},[C("polygon",qe({ref:"polygon"},Ge(e.eventData),{points:e.points,style:{cursor:"pointer"}}),null,16,Vn)],12,Ln)):Qe("",!0)],12,On)}var Fn=ke(An,[["render",En]]);const Nn={name:"loomDropdown",mixins:[Je],methods:{onChange(e){const t=this.targets[Object.keys(this.targetData.children)[e.target.selectedIndex]];this.$emit("changeState",t.id),this.$emit("addHistory",t,e)}},mounted(){this.$nextTick(()=>{this.$refs.dropdown.value=this.$parent.current_state.name})}},Hn=["id"];function Bn(e,t,n,o,a,l){return j(),G("select",{ref:"dropdown",id:e.componentID,style:Z(e.calcStyle),onChange:t[0]||(t[0]=(...i)=>l.onChange&&l.onChange(...i))},[(j(!0),G(Ne,null,He(Object.keys(e.targetData.children),i=>(j(),G("option",{key:i},st(e.targets[i].name),1))),128))],44,Hn)}var Un=ke(Nn,[["render",Bn]]);const jn={name:"USAMap",props:["targetData","vcTargetData"],inject:["manager"],computed:{width(){return this.$parent.targetData.width*this.scale.x},height(){return this.$parent.targetData.height*this.scale.y},scale(){return this.vcTargetData.scale||{x:1,y:1}},calcStyle(){return{position:"absolute",top:"0px",left:"0px",width:`${this.width}px`,height:`${this.height}px`,backgroundColor:"rgba(0,0,0,0.2)",backgroundImage:`url(assets/USA_${this.projectionType}.png)`,backgroundSize:`${this.width}px ${this.height}px`}},stateCenters(){return this.stateCentersTypes[this.projectionType]}},data:function(){return{projectionTypes:["mercator","lambert"],projectionType:null,stateCentersTypes:{mercator:{WA:{x:.084,y:.097},ID:{x:.183,y:.266},MT:{x:.267,y:.115},ND:{x:.425,y:.095},MN:{x:.527,y:.145},MI:{x:.691,y:.27},ME:{x:.958,y:.192},OR:{x:.077,y:.261},WY:{x:.304,y:.286},SD:{x:.427,y:.229},WI:{x:.602,y:.22},NY:{x:.856,y:.295},VT:{x:.895,y:.25},NH:{x:.915,y:.275},MA:{x:.917,y:.314},CT:{x:.892,y:.353},RI:{x:.914,y:.353},CA:{x:.09,y:.526},NV:{x:.142,y:.427},UT:{x:.23,y:.439},CO:{x:.334,y:.457},NE:{x:.431,y:.354},IA:{x:.542,y:.33},IL:{x:.616,y:.411},IN:{x:.664,y:.414},OH:{x:.722,y:.402},PA:{x:.811,y:.384},NJ:{x:.862,y:.425},KS:{x:.455,y:.473},MO:{x:.557,y:.478},KY:{x:.685,y:.511},WV:{x:.762,y:.464},MD:{x:.847,y:.476},DE:{x:.858,y:.455},VA:{x:.801,y:.51},AZ:{x:.23,y:.633},NM:{x:.327,y:.628},TX:{x:.451,y:.743},OK:{x:.477,y:.589},AR:{x:.56,y:.614},TN:{x:.664,y:.578},NC:{x:.785,y:.58},LA:{x:.556,y:.727},MS:{x:.606,y:.69},AL:{x:.657,y:.691},GA:{x:.715,y:.691},SC:{x:.761,y:.651},FL:{x:.741,y:.848}},lambert:{WA:{x:.221,y:.079},ID:{x:.29,y:.241},MT:{x:.377,y:.141},ND:{x:.502,y:.147},MN:{x:.589,y:.203},MI:{x:.742,y:.285},ME:{x:.961,y:.132},OR:{x:.195,y:.203},WY:{x:.391,y:.303},SD:{x:.503,y:.262},WI:{x:.663,y:.253},NY:{x:.891,y:.25},VT:{x:.918,y:.206},NH:{x:.939,y:.212},MA:{x:.939,y:.253},CT:{x:.931,y:.285},RI:{x:.949,y:.282},CA:{x:.173,y:.453},NV:{x:.237,y:.385},UT:{x:.315,y:.429},CO:{x:.412,y:.462},NE:{x:.512,y:.376},IA:{x:.609,y:.359},IL:{x:.675,y:.421},IN:{x:.727,y:.415},OH:{x:.781,y:.391},PA:{x:.859,y:.341},NJ:{x:.914,y:.356},KS:{x:.529,y:.494},MO:{x:.633,y:.503},KY:{x:.747,y:.503},WV:{x:.815,y:.45},MD:{x:.88,y:.397},DE:{x:.901,y:.406},VA:{x:.854,y:.485},AZ:{x:.296,y:.612},NM:{x:.391,y:.629},TX:{x:.508,y:.756},OK:{x:.549,y:.603},AR:{x:.63,y:.629},TN:{x:.734,y:.574},NC:{x:.854,y:.556},LA:{x:.633,y:.768},MS:{x:.68,y:.697},AL:{x:.731,y:.688},GA:{x:.793,y:.691},SC:{x:.835,y:.626},FL:{x:.84,y:.844},AL:{x:.175,y:.821},HI:{x:.414,y:.974}}}}},methods:{getRelativeStateCenters(){const e=this.$refs.target.getBoundingClientRect();return Object.fromEntries(Object.entries(this.stateCenters).map(([t,n])=>[t,{x:n.x*this.width+e.x,y:n.y*this.height+e.y}]))},async getMapping(){return await this.$nextTick(()=>Object.fromEntries(Object.entries(this.getRelativeStateCenters()).map(([t,n])=>{const o=T.getComponentFromPoint(this.manager,...Object.values(n));return o===null?null:[t,{mode:o.renderMode,instance:o.instanceID,page:o.page,vcid:o.vcid,frame:o.frame}]}).filter(t=>t!=null)))}},mounted:function(){this.projectionType="lambert"}};function zn(e,t,n,o,a,l){return j(),G("div",{ref:"target",style:Z(l.calcStyle),onClick:t[0]||(t[0]=(...i)=>e.onclick&&e.onclick(...i))},null,4)}var Yn=ke(jn,[["render",zn]]);const Wn={name:"loomVideoCanvas",emits:["frame_processed"],props:["frameLinkMode","moveRegionMode","editRegionMode","overlay","renderMode","renderAppMode","info","targets","targetData","instanceID","start_state_id"],components:{loomButton:Pn,loomHover:Fn,loomDropdown:Un,loomBrushingBox:Dn,loomUSA:Yn},setup(e,t){const n=Le("manager"),o=Mt(),a=Le("emitter"),{loomVideoCanvasRefs:l}=Le(`instance-${e.instanceID}`),i=n.appRefs[e.instanceID],d=b(100),c=b({x:1,y:1}),k=b(null),P=b(null),W=F(()=>l[z.value]),z=F(()=>e.targetData.id),V=F(()=>e.targetData.page),ve=F(()=>e.renderAppMode),fe=F(()=>e.instanceID),Q=F(()=>e.targetData.width||e.info.window.width),Ce=F(()=>Q*c.x),N=F(()=>e.targetData.height||e.info.window.height),ce=F(()=>N*c.y),Re=F(()=>e.targetData.top||0),Ae=F(()=>e.targetData.left||0),se=F(()=>l[e.targetData.parentCanvas]||!1),pe=Me({}),_e=b(-1),he=b(!1),_=b(!1),x=F(()=>pe[Ie.value]),H=F(()=>T.scalePolygon(x.value,c.value)),re=F(()=>T.polyToPolyString(x.value,0,0)),ge=F(()=>T.polyToPolyString(H.value,0,0)),Ie=F(()=>{for(let s=ne.value;s&&s.parent_id!=s.id;s=e.targets[s.parent_id])if(pe[s.id])return s.id;return-1}),we=()=>{const s={x:le.value.x-ae.value.x,y:le.value.y-ae.value.y},m=c.value;c.value={x:(c.value.x*Q.value+s.x)/Q.value,y:(c.value.y*N.value+s.y)/N.value};const w={x:m.x-c.value.x,y:m.y-c.value.y};e.targetData.scale=c.value;const g=T.boundingBox(x.value);e.targetData.left+=w.x*g.xmin,e.targetData.top+=w.y*g.ymin,S()},be=s=>{const m=10,w=_e.value,g=x.value.length,J=(w+1)%g,D=((w-1)%g+g)%g;if(T.dist(x.value[w],x.value[J])<m||T.dist(x.value[w],x.value[D])<m){x.value.splice(w,1),he.value=!1,S();return}s.x=T.bound(s.x,0,Q.value*c.value.x),s.y=T.bound(s.y,0,N.value*c.value.y),x.value[w]={x:s.x/c.value.x,y:s.y/c.value.y};const K=se.value;if(!K){S();return}const ee=K.targetData.cutouts,I=ee.findIndex(ie=>ie.id==e.targetData.id);if(I>=0){const ie=ee[I];ie.poly=x.value,ee.splice(I,1,ie)}S()},ue=(s,m)=>{x.value.splice(s+1,0,{x:m.x/c.value.x,y:m.y/c.value.y}),he.value=!0,_e.value=s+1,S()},ye=s=>{if(!e.editRegionMode)return-1;const m=2,g=Math.ceil(8/2+m/2);return H.value.map(D=>{let K=0,ee=0;g>D.x?K=-(D.x-g):Ce.value<D.x+g&&(K=Ce.value-(D.x+g)),g>D.y?ee=-(D.y-g):ce.value<D.y+g&&(ee=ce.value-(D.y+g));const I=[{x:D.x+K-g,y:D.y+ee-g},{x:D.x+K+g,y:D.y+ee-g},{x:D.x+K+g,y:D.y+ee+g},{x:D.x+K-g,y:D.y+ee+g}];return T.polyToPath2D(I)}).findIndex(D=>y.value.isPointInPath(D,s.x,s.y))},B=s=>e.editRegionMode?H.value.map((w,g,J)=>{const D=(g+1)%J.length,K=J[D];return T.polyToPath2D([w,K])}).findIndex(w=>y.value.isPointInStroke(w,s.x,s.y)):-1,Te=(s,m)=>{const w="#ff0000",g=2,J=8;s.lineWidth=g,s.strokeStyle=w;let D=function(K,ee){const I=Math.ceil(J/2+g/2);s.strokeRect(T.bound(K,I,Q.value-I)-I,T.bound(ee,I,N.value-I)-I,J,J)}.bind(W.value);s.beginPath(),s.moveTo(T.bound(m[0].x,g/2,Q.value-g/2),T.bound(m[0].y,g/2,N.value-g/2));for(let K=1;K<m.length;++K)s.lineTo(T.bound(m[K].x,g/2,Q.value-g/2),T.bound(m[K].y,g/2,N.value-g/2));s.closePath(),s.stroke(),m.forEach(K=>D(K.x,K.y))},R=b({x:0,y:0}),A=b({x:0,y:0}),ae=b({x:0,y:0}),le=b({x:0,y:0}),De=b(!1),{editRegionMode:Se}=Ct(e),Ve=F(()=>{const s=Math.min(R.value.y,A.value.y)+"px",m=Math.min(R.value.x,A.value.x)+"px",w=Math.abs(A.value.x-R.value.x)+"px",g=Math.abs(A.value.y-R.value.y)+"px";return{position:"absolute",display:O.value?"block":"none","background-color":"rgba(0, 0, 0, 0.5)","border-style":"dashed","pointer-events":"none",top:s,left:m,width:w,height:g}});rt(Se,()=>{S(!1,!0)});const r=s=>{const{left:m,top:w}=k.value.getBoundingClientRect();return{x:s.clientX-m-e.targetData.left,y:s.clientY-w-e.targetData.top}},f=s=>{if(ae.value=le.value,le.value=r(s),he.value&&e.targetData.reshapeable!==!1){be(le.value);return}else if(_.value&&e.targetData.resizeable!==!1){we();return}else Se.value&&(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)&&(ye(le.value)>=0?document.body.style.cursor="move":B(le.value)>=0&&(document.body.style.cursor="crosshair"));De.value&&e.targetData.movable!==!1&&(e.moveRegionMode&&(e.targetData.top+=s.movementY,e.targetData.left+=s.movementX),A.value=le.value)},p=s=>{const m=r(s),w=s.shiftKey;if(Se.value&&(e.targetData.reshapeable!==!1||e.targetData.resizeable!==!1)){const g=ye(m);if(g>=0&&(w&&e.targetData.resizeable!==!1?(_.value=!0,he.value=!1):e.targetData.reshapeable!==!1&&(_.value=!1,he.value=!0,_e.value=g)),g<0&&e.targetData.reshapeable!==!1){const J=B(m);J>=0&&(ue(J,m),S())}}},M=s=>(a.emit("deselectAll"),document.body.style.cursor="default",le.value=r(s),Se.value?A.value=R.value=le.value:A.value=R.value={x:-1e4,y:-1e4},De.value=!0,a.emit("selectVideoCanvas",W.value),!1),v=s=>{De.value=!1,_.value=!1,he.value=!1,document.body.style.cursor="default"},E=()=>{R.value=A.value={x:-1e4,y:-1e4}},X=()=>{De.value=!1,R.value.x=R.value.y=A.value.x=A.value.y=-1e4},O=F(()=>!(!Se.value||e.moveRegionMode||R.value.x==-1e4||R.value.y==-1e4||A.value.x==-1e4||A.value.y==-1e4||Math.abs(A.value.x-R.value.x)<5||Math.abs(A.value.y-R.value.y)<5));rt(O,s=>{a.emit("regionExists",{exists:s,origin:W.value})});const me=()=>{R.value.x>A.value.x&&([R.value.x,A.value.x]=[A.value.x,R.value.x]),R.value.y>A.value.y&&([R.value.y,A.value.y]=[A.value.y,R.value.y]),h(T.rectToPoly({x:R.value.x,y:R.value.y,width:A.value.x-R.value.x,height:A.value.y-R.value.y})),R.value=A.value={x:-1e4,y:-1e4}},u=(s,m=!0)=>{h(s,!1,m)},h=(s,m=!0,w=!0)=>{if(s.length>0&&!e.targetData.parentCanvas){i.newVideoTarget({parentCanvas:e.targetData.id,startupFn:g=>{g.cutRegions(s,m,w),g.emitter.emit("deselectAll"),delete g.targetData.startupFn},processed:!0});return}s.length>0&&s[0].constructor!==Array&&(s=[s]),s.forEach(g=>{const J=String(Object.keys(i.currentVideoTargets).length);i.currentVideoTargets[J]={page:e.targetData.page,id:J,current_state_id:ne.value.id,region:g,top:e.targetData.top,left:e.targetData.left,makeCutout:m,parentCanvas:e.targetData.id,cutouts:[],startupFn:D=>{D.emitter.emit("deselectAll"),delete D.targetData.startupFn},processed:!0}})},y=b(null),S=(s=!1,m=!1)=>{a.emit("changeVideoFrame",[e.instanceID,V.value,z.value,q.value,q.value,s,m])},L=(s,m=!0)=>{if(!(te.value||!s)){if(y.value.restore(),y.value.save(),y.value.fillStyle="rgba(0, 0, 0, 0)",y.value.clearRect(0,0,Q.value,N.value),e.targetData.drawImage!==!1){const w=s.videoWidth/s.clientWidth,g=s.videoHeight/s.clientHeight;y.value.drawImage(s,0,0,Q.value*w,N.value*g,0,0,Q.value,N.value)}Se.value&&x.value&&Te(y.value,x.value),m&&a.emit("post_redraw"+e.targetData.id),Y(),te.value=!0,setTimeout(()=>te.value=!1,20)}},Y=()=>{if(e.targetData.processed||!P.value)return;const s=cv.imread(P.value);cv.cvtColor(s,s,cv.COLOR_RGBA2GRAY,0),cv.threshold(s,s,254,255,cv.THRESH_BINARY);const m=new cv.MatVector,w=new cv.Mat;cv.findContours(s,m,w,cv.RETR_TREE,cv.CHAIN_APPROX_SIMPLE);const g=[],J=Array.from(w.data32S);for(;J.length>0;)g.push(J.splice(0,4));const D=[];g.forEach((I,ie)=>{I[2]!=-1&&I[3]==-1&&D.push(ie)});function K(I,ie){const Ee={left:I.x,top:I.y,right:I.x+I.width,bottom:I.y+I.height},Fe={left:ie.x,top:ie.y,right:ie.x+ie.width,bottom:ie.y+ie.height};return!(Fe.left>Ee.right||Fe.right<Ee.left||Fe.top>Ee.bottom||Fe.bottom<Ee.top)}const ee=D.filter(I=>cv.contourArea(m.get(parseInt(I)),!1)>1e3).map(I=>cv.boundingRect(m.get(parseInt(I)))).sort((I,ie)=>I.width*I.height>ie.width*ie.height).filter((I,ie,Ee)=>!Ee.slice(ie+1).some(Fe=>K(Fe,I))).filter(I=>Math.abs(Q.value-I.width)>100&&Math.abs(N.value-I.height)>100).map(T.rectToPoly);ee.length!=0&&h(ee,!0,!0),s.delete(),m.delete(),w.delete(),t.emit("frame_processed")},q=b(null),te=b(!1),U=b(!0),Pe=(s,m=0,w=!0,g=!0)=>{Ue(e.targets[s].frame_no,m,w,g)},Ue=(s,m=0,w=!0,g=!0)=>{const J=s+1+m;if(q.value==J)return;a.emit("changeVideoFrame",[e.instanceID,V.value,z.value,q.value,J,g])[0].some(ee=>ee.instance==fe.value&&ee.page==V.value&&ee.vcid==z.value)&&(q.value=J,w&&U.value&&i.changeStateWithFrameNo(s,m),e.targetData.current_state_id=Object.values(e.targets).find(ee=>ee.frame_no==s).id)},Ze=(s,m)=>{i.updateInteractionHistory(s,m,e.targetData.id)},oe=Me({}),ne=F(()=>Object.values(e.targets).find(s=>s.id==e.targetData.current_state_id)||Object.values(e.targets).sort((s,m)=>s.frame_no-m.frame_no)[0]),ht=F(()=>T.currentTargets(ne.value,e.targets)),gt=s=>{if(s.id=="-1")return;const m=`loom${s.actor.charAt(0).toUpperCase()+s.actor.slice(1)}`;if($e[e.renderAppMode]&&$e[e.renderAppMode].mappings){const w=$e[e.renderAppMode].mappings[m];if(w&&o.components[w])return o.components[w]}if(o.components[m])return o.components[m]};et(()=>{if(y.value=P.value.getContext("2d"),y.value.save(),V.value==i.currentPage&&e.start_state_id!==void 0&&(e.targetData.current_state_id=e.start_state_id),ne.value!==void 0&&(Pe(ne.value.id,0,!1),e.targetData.region?pe[Ie.value]=e.targetData.region:pe[Ie.value]=[{x:0,y:0},{x:Q.value,y:0},{x:Q.value,y:N.value},{x:0,y:N.value}],e.targetData.makeCutout&&i)){const s=x.value,m=Math.min(...s.map(D=>D.x)),w=Math.max(...s.map(D=>D.x)),g=Math.min(...s.map(D=>D.y)),J=Math.max(...s.map(D=>D.y));se.value&&se.value.targetData.cutouts.push({poly:x.value,width:w-m,height:J-g,top:g,left:m,id:e.targetData.id})}e.targetData.startupFn&&e.targetData.startupFn(W.value),a.on("clearSelection",E),a.on("deselectAll",X),a.on(`changeState-${e.targetData.id}`,Pe),a.on("mousemove",f),a.on("mouseup",v),a.on("mousedown",p),De.value=!1,a.emit("selectVideoCanvas",W.value)}),_t(()=>{if(se.value&&se.value.targetData){const s=se.value.targetData.cutouts.findIndex(m=>m.id===e.targetData.id);s>=0&&se.value.targetData.cutouts.splice(s,1)}a.off("clearSelection",E),a.off("deselectAll",X),a.off(`changeState-${e.targetData.id}`,Pe),a.off("mousemove",f),a.off("mouseup",v),a.off("mousedown",p)});const nt={utils:T,zIndex:d,selected:De,dragStart:R,dragCurr:A,lastMouseLoc:ae,mouseLoc:le,reshapePolygonMode:he,resizePolygonMode:_,ctx:y,polygonMasks:pe,polygonReshapeIdx:_e,updateParentCurrentState:U,lastFrame:q,throttle:te,editRegionMode:Se,scale:c,loomVideoCanvasRefs:l,componentRefs:oe,instanceRef:i,canvasRef:P,containerRef:k,current_state:ne,currentTargets:ht,id:z,page:V,mode:ve,instance:fe,width:Q,scaledWidth:Ce,height:N,scaledHeight:ce,top:Re,left:Ae,parentCanvasRef:se,currentPolygonMaskID:Ie,currentPolygonMask:x,currentPolygonMaskScaled:H,currentPolygonMaskString:re,currentPolygonMaskStringScaled:ge,regionExists:O,dragSelectStyle:Ve,getComponent:gt,changeState:Pe,changeStateWithFrameNo:Ue,addHistory:Ze,cutSelectedRegion:me,copyRegions:u,cutRegions:h,resizePolygon:we,reshapePolygon:be,addNewVertex:ue,isPolygonVertexHovered:ye,isPolygonLineHovered:B,clientToOffset:r,onScreenMouseMove:f,onScreenMouseDown:p,onVideoMouseDown:M,onScreenMouseUp:v,drawPolyOutline:Te,redraw:S,draw:L,processFrame:Y,clearSelection:E,deselect:X};return We(`videoCanvas-${z}`,nt),nt}},Xn={"pointer-events":"none"},Jn=["id"],Kn=["points"],Zn=["width","height"],qn={class:"offset",style:{position:"absolute",top:"0px",left:"0px"}},Gn=["width","height"],Qn=["points"];function ea(e,t,n,o,a,l){return j(),G("div",{ref:"containerRef",style:Z([{height:"0px",width:"0px","pointer-events":"auto"},{zIndex:e.zIndex}])},[(j(),G("svg",Xn,[C("clipPath",{id:`clipping-${n.instanceID}-${n.targetData.id}`},[C("polygon",{"pointer-events":"fill",points:e.currentPolygonMask?e.currentPolygonMaskStringScaled:null},null,8,Kn)],8,Jn)])),C("div",{style:Z({position:"absolute",top:e.top+"px",left:e.left+"px",clipPath:`url(#clipping-${n.instanceID}-${e.id})`}),onClick:t[0]||(t[0]=i=>{e.emitter.emit("clickVideoCanvas",i)}),onMousedown:t[1]||(t[1]=(...i)=>e.onVideoMouseDown&&e.onVideoMouseDown(...i))},[C("div",null,[C("canvas",{ref:"canvasRef",width:e.width,height:e.height,style:Z({width:(e.width*e.scale.x).toPrecision(4)+"px",height:(e.height*e.scale.y).toPrecision(4)+"px",zIndex:e.zIndex})},null,12,Zn),C("div",{style:Z(e.dragSelectStyle)},null,4),C("div",{class:"overlay",style:Z([{display:n.overlay?"block":"none"},{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%","background-color":"rgba(0, 0, 0, 0.5)"}])},null,4)]),C("div",qn,[(j(!0),G(Ne,null,He(e.currentTargets,i=>(j(),Xe(bt(e.getComponent(i)),{key:i.id,ref_for:!0,ref:d=>{d&&(e.componentRefs[i.id]=d)},targetData:i,vcTargetData:n.targetData,targets:n.targets,showHint:n.overlay,interactable:!(n.moveRegionMode||n.editRegionMode||n.frameLinkMode),onChangeState:e.changeState,onAddHistory:e.addHistory},null,8,["targetData","vcTargetData","targets","showHint","interactable","onChangeState","onAddHistory"]))),128))]),(j(!0),G(Ne,null,He(n.targetData.cutouts,(i,d)=>(j(),G("svg",{key:d,width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),style:Z({width:(e.width*e.scale.x).toPrecision(4),height:(e.height*e.scale.y).toPrecision(4),top:"0px",left:"0px",position:"absolute",fill:"black"}),"pointer-events":"none"},[C("polygon",{"pointer-events":"fill",points:e.utils.polyToPolyString(e.utils.scalePolygon(i.poly,e.scale),0,0)},null,8,Qn)],12,Gn))),128))],36)],4)}var ta=ke(Wn,[["render",ea]]);const na={name:"LoomInstance",components:{loomVideoCanvas:ta},props:{renderMode:String,videoTargetCache:{type:Object,default:{}},video_filename:{type:String,default:"video.mp4"},directory:String,moveRegionMode:Boolean,frameLinkMode:Boolean,editRegionMode:Boolean,overlay:Boolean,id:String,name:String},setup(e,t){const n=Le("emitter"),{appConfig:o,linkedCanvases:a,appRefs:l,zip:i}=Le("manager"),d=b(!1),c=b(null),k=b(null),P=b(null),W=r=>{for(let f=0;f<_.value;++f)z(f,r)},z=(r,f)=>{const p={id:r,promises:[]};x.push(p),ze(()=>{const M=V(re[r],f);M?p.player=M:console.error("No Player!")})},V=(r,f)=>{const p=lt.getPlayer(r);if(p)return p;const M={sources:[{src:"data:video/mp4;base64,"+btoa(f),type:"video/mp4"}],controls:!1,loadingSpinner:!1,controlBar:!1};return lt(r,M,function(){this.on("click",function(v){v.preventDefault()})})},ve=()=>d.value?Promise.resolve([k,o.value]):fetch(e.directory+".rva").then(r=>r.blob()).then(async r=>{const p=await new i.ZipReader(new i.BlobReader(r)).getEntries(),M=await p[1].getData(new i.BlobWriter);let v=new FileReader;return v.onloadend=X=>W(X.target.result),v.readAsBinaryString(M),p[0].getData(new i.TextWriter)}).then(r=>JSON.parse(r)).catch(r=>null).then(r=>r==null?(console.error(`ERROR, IS_config not loaded
`),[null,null]):r.info.version!=$e.version?(console.error("ERROR, out of version IS_config file, run Recorder/convert.py"),[null,null]):(k.value=r,P.value=k.value.hasOwnProperty(c.value)?k.value[c.value]:k.value.original,d.value=!0,ue.hidden={},e.videoTargetCache.hidden={},ue.original=k.value.original.data,[k,o.value])),fe=r=>(c.value=`${r.value}_${r.renderMode}`,ve().then(([f,p])=>{if(f===null||p===null)return;r.selected||(c.value="hidden"),pe(c.value,r.renderMode),Q(p,r.value,r.renderMode),Ce(c.value),N.value=Object.values(we.value).filter(v=>v.frame_no>0).sort((v,E)=>v.frame_no-E.frame_no)[0],Ae(N.value.id);const M=Object.values(a.value.sets).find(v=>v.data.instance==e.id);if(M){const v=M.data;n.emit("changeVideoFrame",[v.instance,v.page,v.vcid,-1,v.frame,!1])}})),Q=(r,f,p)=>{const M=`${f}_${p}`;if(!r||r[M]===void 0)return;const v=r[M],E=T.deepCopy(v);for(const X of Object.values(E))for(const O of Object.values(X)){O.processed=O.processed===void 0?Boolean(O.cutouts&&O.cutouts.length>0):O.processed,O.cutouts=O.cutouts||[];const me=f,u=O.linkedFrames||[];for(const h of u){const y={mode:p,instance:me,page:O.page,vcid:O.id};for(const S of h.frames){const L=je(Oe({},y),{frame:S[0]}),Y=je(Oe({},h),{frame:S[1]}),q=`${L.instance}_${L.page}_${L.vcid}_${L.frame}`,te=`${Y.instance}_${Y.page}_${Y.vcid}_${Y.frame}`;a.value.exists(q)||a.value.add(q,L),a.value.exists(te)||a.value.add(te,Y),a.value.merge(q,te)}}if(O.parentCanvas&&O.parentCanvas!="-1"){const h=be[O.parentCanvas];if(O.makeCutout&&h){h.targetData.cutouts=O.parentCanvas.cutouts||[];const y=O.region,S=Math.min(...y.map(U=>U.x)),L=Math.max(...y.map(U=>U.x)),Y=Math.min(...y.map(U=>U.y)),q=Math.max(...y.map(U=>U.y));h.targetData.cutouts.push({poly:y,width:L-S,height:q-Y,top:Y,left:S,id:O.id})}}}for(let X in v)e.videoTargetCache[M][X]=v[X]},Ce=r=>{e.videoTargetCache.hasOwnProperty(r)||R({processed:!1},r)},N=b(null),ce=Me([]),Re=b(30),Ae=(r,f=0)=>{const p=we.value[r];if(p===void 0){console.error("Invalid state");return}se(p.frame_no)},se=r=>{N.value=Object.values(we.value).find(f=>f.frame_no==r)},pe=(r,f)=>{ue.hasOwnProperty(r)||(k.value.hasOwnProperty(r)||(k.value[r]=Mn(k.value,ue.original,f)),ue[r]=k.value[r].data||{})},_e=(r,f,p)=>{const M={id:r.id,videoCanvas:p,target:r,event:f};ce.push(M),ce.length>Re.value&&ce.shift(),n.emit("runInteractionAnalysis",ce)},he=b(30),_=b(3),x=Me([]),H=b(0),re=Me({}),ge=(r,f,p,M=!0)=>{if(!p&&p!==0){be[f].draw(null,M);return}const v=x[H.value];if(!!v)return H.value=(H.value+1)%_.value,new Promise((E,X)=>{v.promises.push(E),v.inUse||E(E),setTimeout(()=>X(E),1e3)}).then(E=>{const X=v.promises.findIndex(O=>O==E);v.player.on("timeupdate",function O(){const me=re[v.id];!me||(be[f]&&be[f].draw(me,M),v.player.off("timeupdate",O),v.promises[X+1]&&v.promises[X+1](v.promises[X+1]),v.inUse=!1,v.promises.splice(X,1))}),v.inUse=!0,v.player.currentTime(p/he.value)}).catch(E=>{const X=v.promises.findIndex(O=>O==E);v.promises.splice(X,1),console.warn("frame took too long")})},Ie=(r,f)=>{const p=l[r.instance].renderAppMode;e.videoTargetCache[p][r.page][r.vcid].linkedFrames==null&&(e.videoTargetCache[p][r.page][r.vcid].linkedFrames=[]);const M=e.videoTargetCache[p][r.page][r.vcid].linkedFrames,v=M.find(E=>E.mode==f.mode&&E.page==f.page&&E.vcid==f.vcid);if(v!=null)v.frames=v.frames||[],v.frames.push([r.frame,f.frame]);else{const E=Oe({},f);r.instance!=f.instance&&(delete E.frame,E.frames=[[r.frame,f.frame]]),M.push(E)}},we=F(()=>{const r=T.shallowCopy(ue.original);delete r.mode;const f=T.shallowCopy(ue[c.value]||{});return delete f.mode,T.deepMerge(r,f)}),be=Me({}),ue=Me({}),ye=F(()=>{if(!N.value||!e.videoTargetCache[c.value])return[null,null];const r=Object.entries(e.videoTargetCache[c.value]);let f=null,p="-1";for(let M=N.value;f===null&&M&&M.id!=M.parent_id;M=we.value[M.parent_id])if(!(typeof M.frame_no=="string"&&M.frame_no.includes("frameless"))){for(let v=0;v<r.length;++v)if(String(M.id)===r[v][0]){f=r[v][1],p=r[v][0];break}}return f===null&&(f=e.videoTargetCache[c.value]["-1"]),[p,f]}),B=F(()=>ye.value[1]),Te=F(()=>ye.value[0]),R=async(r={},f=void 0,p=!1)=>{f===void 0&&(f=c.value);let M="-1",v=0;e.videoTargetCache.hasOwnProperty(f)?(r.newPageFromRoot===!1?M=Te.value:M=String(N.value.id),v=M):e.videoTargetCache[f]={};const E=T.rectToPoly({x:0,y:0,width:k.value.info.window.width,height:k.value.info.window.height});(!e.videoTargetCache[f][M]||p)&&(e.videoTargetCache[f][M]={});const X=String(Object.keys(e.videoTargetCache[f][M]).length);return e.videoTargetCache[f][M][X]=Oe({page:M,id:X,current_state_id:v,region:E,top:0,left:0,makeCutout:!1,parentCanvas:!1,cutouts:[],startupFn:null,processed:!0},r),await ze(()=>be[X])},Ve={IS_config:k,currentConfig:P,current_state:N,loaded:d,renderAppMode:c,transformedTargetCache:ue,videoPlayers:x,interactionHistory:ce,maxHistoryLength:Re,numVideoPlayers:_,lastUsedVideoPlayer:H,targets:we,computeCurrentVideoTargets:ye,currentVideoTargets:B,currentPage:Te,setupVideo:V,load:ve,init:fe,init_videoTargetCache:Q,updateInteractionHistory:_e,addInstanceLink:Ie,changeState:Ae,changeStateWithFrameNo:se,targetCacheModeChange:pe,newVideoTarget:R,destroyVideoTarget:async(r,f,p)=>{delete e.videoTargetCache[r][f][p]},changeVideoFrame:ge,createNewVideoPlayer:z,videoCacheModeChange:Ce,Up:r=>{r.zIndex++},Down:r=>{r.zIndex--},Delete:r=>{let f=null;r===null&&B.value!==null?f="-1":r&&(f=r.id),f!==null&&delete B.value[f]},paste:r=>{if(!r)return;const f=r.startupFn,p=T.deepCopy(r);for(p.startupFn=M=>{M.updateParentCurrentState=!1,f&&f(M)},p.id="0";B.value[p.id]!==void 0;)p.id=String(parseInt(p.id)+1);B.value[p.id]=p},loomVideoCanvasRefs:be,videoPlayerRefs:re};return We(`instance-${e.id}`,Ve),Ve}};function aa(e,t,n,o,a,l){const i=Be("loom-video-canvas");return j(),G("div",{id:"loom",style:Z({height:e.IS_config?e.IS_config.info.window.height+"px":"0px",width:e.IS_config?e.IS_config.info.window.width+"px":"0px",position:"absolute","margin-left":"auto","margin-right":"auto","margin-top":"25px",left:0,right:0,"text-align":"center","pointer-events":"none"})},[(j(!0),G(Ne,null,He(e.videoPlayers,(d,c)=>(j(),G("video",{key:c,ref_for:!0,ref:k=>{k&&(e.videoPlayerRefs[d.id]=k)},style:Z([{width:e.IS_config?e.IS_config.info.window.width+"px":"0px",height:e.IS_config?e.IS_config.info.window.height+"px":"0px"},{position:"absolute",top:"0px",left:"0px",visibility:"hidden"}]),class:"video-js",crossorigin:"anonymous"},null,4))),128)),(j(!0),G(Ne,null,He(e.currentVideoTargets,d=>(j(),Xe(i,{key:`${e.renderAppMode}-${d.page}-${d.id}`,ref_for:!0,ref:c=>{c&&(e.loomVideoCanvasRefs[d.id]=c)},instanceID:n.id,targets:d.targets||e.targets,targetData:d,start_state_id:e.current_state.id,moveRegionMode:n.moveRegionMode,frameLinkMode:n.frameLinkMode,overlay:n.overlay,renderMode:n.renderMode,renderAppMode:e.renderAppMode,currentConfig:e.currentConfig,info:e.IS_config.info,editRegionMode:n.editRegionMode,onFrame_processed:()=>d.processed=!0},null,8,["instanceID","targets","targetData","start_state_id","moveRegionMode","frameLinkMode","overlay","renderMode","renderAppMode","currentConfig","info","editRegionMode","onFrame_processed"]))),128))],4)}var oa=ke(na,[["render",aa],["__scopeId","data-v-1e779ba5"]]);function ia(e,t=0,n=-1){this.rank=t,this.parent=n,this.data=e,this.children=[]}function dt(){this.sets={},this.nsets=0}dt.prototype={add(e=void 0,t=void 0){return e==null&&(e=this.sets.length),this.sets.hasOwnProperty(e)?null:(this.sets[e]=new ia(t),this.sets[e].children.push(e),++this.nsets,e)},find(e){return this.sets[e]?this.sets[e].parent==-1?e:(this.sets[e].parent=this.find(this.sets[e].parent),this.sets[e].parent):null},transferChildren(e,t){const n=this.sets[e],o=this.sets[t];o.children=o.children.concat(n.children),n.children=[]},merge(e,t){if(e=this.find(e),t=this.find(t),e==null||t==null)return null;if(e!=t){const n=this.sets[e],o=this.sets[t];n.rank>o.rank?(o.parent=e,this.transferChildren(t,e)):n.rank<o.rank?(n.parent=t,this.transferChildren(e,t)):(o.parent=e,++n.rank,this.transferChildren(t,e)),--this.nsets}return this.find(e)},of(e){return this.sets[this.find(e)].children.map(t=>this.sets[t].data)},connected(e,t){return this.find(e)===this.find(t)},at(e){return this.sets[e].data},exists(e){return this.sets.hasOwnProperty(e)},size(){return this.nsets}};kt({useWebWorkers:!1});const sa={components:{loomInstance:oa},props:["directory","modifier_directory"],setup(e,t){const n=Le("emitter"),o=b(null),a=b(!1),l=b(!1),i=b(!1),d=b(!1),c=b(!1),k=b(null),P=b(null),W=u=>{R.value=u,le()},z=()=>{B[_.value.instanceID]&&B[_.value.instanceID].Up(_.value)},V=()=>{B[_.value.instanceID]&&B[_.value.instanceID].Down(_.value)},ve=()=>{B[_.value.instanceID]&&B[_.value.instanceID].Delete(_.value)},fe=()=>{P.value=_.value},Q=()=>{fe(),ve()},Ce=()=>{const u=P.value;fe(),N(),P.value=u},N=()=>{if(B[P.value.instanceID]){const u=T.deepCopy(P.value.targetData);u.makeCutout=!1,B[P.value.instanceID].paste(u)}},ce=()=>{let u="None";ae.value.startState&&ae.value.startState.saveName&&(u=ae.value.startState.saveName);let h=prompt(`Enter name to save config as: (default: ${u})`);if(!h){if(!u||u=="None")return;h=u}const y=new Set(JSON.parse(localStorage.getItem("saveNames")))||new Set;y.has(h)&&!confirm("Name already taken")||(y.add(h),ae.value.startState={saveName:h,appMode:R.value},ze(()=>{try{localStorage.setItem("saveNames",JSON.stringify([...y])),localStorage.setItem(h,JSON.stringify(ae.value))}catch(S){alert(`Could not save to localStorage: ${String(S)}`),console.error(S)}}))},Re=u=>{if(ue.value===null)return!1;let h=new Set(ye.value.map(L=>L.split(".")[0])),y=localStorage.getItem("saveNames");if(y&&(y=JSON.parse(y),y.forEach(L=>h.add(L))),!h)return alert("No files to load"),!1;h=Array.from(h);function S(L){if(ae.value=L,ae.value.startState&&ae.value.startState.appMode){const Y=ae.value.startState.appMode;Y.forEach(q=>{let te;ae.value.directory?te=ae.value.directory:te=e.directory+"/"+q;const U=te.split("/").filter(Pe=>Pe!="").slice(-1)[0].replaceAll(" ","_");Te.push({directory:te,label:U.charAt(0).toUpperCase()+U.slice(1),minLabel:(U.charAt(0).toUpperCase()+U.slice(1)).substr(0,4)+"...",value:U})}),A.value="desktop",R.value=Y.map(q=>q.split().join("_"))}ze(le)}if(u===void 0&&(u=prompt(`Enter file (blank to upload)
 Available names: `+h.join(", "))),u==="")Ae().then(L=>{const Y=new FileReader;Y.onload=q=>{S(JSON.parse(q.target.result)),ce()},Y.readAsText(L)});else if(h.some(L=>L==u)){const L=h.indexOf(u),Y=ue.value[L];return S(Y||JSON.parse(localStorage.getItem(u))),!0}else return alert("File does not exist"),!1};function Ae(){return new Promise(u=>{let h=document.createElement("input");h.type="file",h.onchange=y=>{let S=Array.from(h.files);u(S[0])},h.click()})}const se=b([]),pe=([u,h])=>{se.value[u]=h},_e=u=>{delete se[u]},he=u=>T.getComponentFromPoint(me,u.x,u.y),_=b(null),x=b(new dt),H=async(u=null,h=void 0,y=!0)=>{if(B[_.value.instanceID])return await B[_.value.instanceID].newVideoTarget(u,h,y)},re=u=>{B[u.instanceID].destroyVideoTarget(u.mode,u.page,u.id)},ge=()=>{l.value=!0,k.value.cutSelectedRegion()},Ie=(u,h,y,S,L,Y,q=!1)=>{const te=[];if(!(S==L&&!q))return x.value.exists(`${u}_${h}_${y}_${L}`)?x.value.of(`${u}_${h}_${y}_${L}`).forEach(U=>{U.componentID===void 0&&B[U.instance]&&(B[U.instance].changeVideoFrame(U.page,U.vcid,U.frame,Y),te.push({instance:U.instance,page:U.page,vcid:U.vcid}))}):B[u]&&(B[u].changeVideoFrame(h,y,L,Y),te.push({instance:u,page:h,vcid:y})),te},we=(u,h)=>{let y=null;return h==null?y={instance:u.instanceID,page:u.page,vcid:u.id,frame:u.lastFrame}:y={instance:u.instanceID,page:u.page,vcid:u.id,frame:h.frame,componentID:h.componentID},y},be=(u,h)=>{let y,S;S=`${u.instance}_${u.page}_${u.vcid}_${u.frame}`,y=`${h.instance}_${h.page}_${h.vcid}_${h.frame}`,x.value.exists(S)||x.value.add(S,u),x.value.exists(y)||x.value.add(y,h),x.value.merge(S,y),_.value.instanceRef.addInstanceLink(u,h)},ue=b(null),ye=b(null),B=Me({}),Te=Me([]),R=b(null),A=b(null),ae=b({}),le=()=>{if(!R.value)return;Te.map(h=>Oe({selected:R.value.includes(h.value)},h)).forEach(async h=>{const y=je(Oe({},h),{renderMode:A.value});B.hasOwnProperty(h.value)&&await B[h.value].init(y)})},De=function(u){const h="https://api.github.com/repos/branson2015/DeRe_Apps/git/trees/main?recursive=1",y="http://localhost:8000/apps";return Promise.all([fetch(h),fetch(y).catch(()=>({ok:!1})).then(S=>S.ok?S:new Response("[]"))]).then(S=>Promise.all(S.map(L=>L.json()))).then(S=>{const[L,Y]=S,q=L.tree.map(oe=>oe.path),te=q.filter(oe=>oe.substr(0,"demos/demos/".length)==="demos/demos/").map(oe=>oe.substr("demos/demos/".length)),U=q.filter(oe=>oe.substr(0,"RVA/".length)==="RVA/").map(oe=>oe.substr("RVA/".length));ye.value=te;const Pe=ye.value.map(oe=>fetch(`${e.modifier_directory}/${oe}`).then(ne=>ne.json()));let Ue=[];Y.length>0&&(Ue=Y.map(oe=>{const ne=oe.slice(0,-4);return ye.value.push(ne),{hidden:{},[ne]:{},directory:`http://localhost:8000/apps/${ne}`,startState:{saveName:ne,appMode:[ne],current_state:1}}}));const Ze=U.map(oe=>{const ne=oe.slice(0,-4);return ye.value.push(ne),{hidden:{},[ne]:{},startState:{saveName:ne,appMode:[ne],current_state:0}}});return Promise.all(Pe).then(oe=>{ue.value=[...Pe,...Ue,...Ze]})})},Se=u=>{a.value&&H()},Ve=u=>{l.value&&c&&ge()},r=u=>{a.value&&_&&Q()},f=u=>{a.value&&_&&fe()},p=u=>{a.value&&_&&Ce()},M=u=>{a.value&&P&&N()},v=u=>{a.value&&_&&ve()},E=u=>{a.value&&_&&z()},X=u=>{a.value&&_&&V()},O=u=>{A.value=u,le()};et(()=>{window.app=me,n.on("regionExists",u=>{c.value=u.exists,k.value=u.origin}),n.on("selectVideoCanvas",u=>{_.value=u}),n.on("changeVideoFrame",u=>Ie(...u)),n.on("addComponent",pe),n.on("removeComponet",_e),n.on("newCanvasClicked",Se),n.on("newRegionClicked",Ve),n.on("cutRegionClicked",r),n.on("copyRegionClicked",f),n.on("duplicateRegionClicked",p),n.on("pasteRegionClicked",M),n.on("deleteRegionClicked",v),n.on("ZupClicked",E),n.on("ZdownClicked",X),n.on("saveVideoCanvasState",ce),n.on("loadVideoCanvasState",Re),n.on("renderModeChange",O),n.on("call",u=>{const h=u.shift();return me[h](...u)}),n.on("do",u=>u(me)),n.on("getManager",()=>me),De(e.modifier_directory).then(()=>{n.emit("ready")})});const me={getModifierFiles:De,appModes:Te,appMode:R,renderMode:A,moveRegionMode:a,hintMode:d,editRegionMode:l,frameLinkMode:i,regionExists:c,regionOrigin:k,currVideoCanvasSelected:_,pasteBin:P,linkedCanvases:x,appConfig:ae,activeComponents:se,init:le,newVideoTarget:H,destroyVideoTarget:re,cutRegion:ge,renderModeChange:O,onAppModeChange:W,saveVideoCanvasState:ce,loadVideoCanvasState:Re,createLinkEntry:we,createLink:be,changeVideoFrame:Ie,Up:z,Down:V,Delete:ve,copy:fe,cut:Q,duplicate:Ce,paste:N,componentClicked:he,addComponent:pe,removeComponent:_e,managerRef:o,appRefs:B,utils:T,zip:wt,emitter:n};return We("manager",me),me}},ra={ref:"managerRef"},la={style:{position:"relative"}};function ca(e,t,n,o,a,l){const i=Be("loom-instance");return j(),G("div",ra,[C("div",la,[(j(!0),G(Ne,null,He(e.appModes,(d,c)=>(j(),Xe(i,{key:String(c),id:d.value,ref_for:!0,ref:k=>{k&&(e.appRefs[d.value]=k)},name:d.value,directory:d.directory,videoTargetCache:e.appConfig,moveRegionMode:e.moveRegionMode,editRegionMode:e.editRegionMode,frameLinkMode:e.frameLinkMode,overlay:e.hintMode,renderMode:e.renderMode},null,8,["id","name","directory","videoTargetCache","moveRegionMode","editRegionMode","frameLinkMode","overlay","renderMode"]))),128))])],512)}var ua=ke(sa,[["render",ca]]);const da={components:{Multiselect:Dt},props:[],setup(e,t){const n=Le("emitter");let o=b(null);const a=Me({linkMode:"selectable",firstLink:null}),l=F(()=>({none:{color:"grey",cursor:"default"},selectable:{color:"white",cursor:"pointer"},linkingFrom:{color:"green",cursor:"pointer"},linkingTo:{color:"red",cursor:"pointer"}})[a.linkMode]),i=Me({mapLinkMode:"selectable",firstLink:null,mapComponent:null}),d=async _=>{const x=()=>{i.mapComponent!=null&&o.value.destroyVideoTarget(i.mapComponent.$parent),i.mapLinkMode="selectable",i.firstLink=null,i.mapComponent=null};if(i.mapLinkMode=="selectable"){if(i.mapComponent!=null)return;i.mapComponent=(await c()).componentRefs["0"],i.mapLinkMode="linkingFrom"}else if(i.mapLinkMode=="linkingFrom")i.firstLink=await i.mapComponent.getMapping(),i.mapLinkMode="linkingTo";else if(i.mapLinkMode=="linkingTo"){const H=await i.mapComponent.getMapping(),re=i.firstLink;Object.keys(H).forEach(ge=>{re.hasOwnProperty(ge)&&o.value.createLink(re[ge],H[ge])}),x()}},c=async()=>{const _=550,x=315;return await o.value.newVideoTarget({reshapeable:!1,resizeable:!0,region:T.rectToPoly({x:0,y:0,width:_,height:x}),width:_,height:x,targets:[{actor:"USA",id:"0",important:!0}],startupFn:H=>{H.lastFrame=0,delete H.targetData.startupFn},drawImage:!1,newPageFromRoot:!1,current_state_id:"0"},void 0,!1)},k=F(()=>({cursor:"pointer",color:{selectable:"white",linkingFrom:"green",linkingTo:"red"}[i.mapLinkMode]})),P=()=>{a.linkMode=a.linkMode=="selectable"?"linkingFrom":"selectable"},W=_=>{a.linkMode!=="selectable"&&ze(()=>{const x=n.emit("call",["componentClicked",_]);a.linkMode==="linkingFrom"?(n.emit("do",H=>{a.firstLink=H.createLinkEntry(H.currVideoCanvasSelected.value,x)}),a.linkMode="linkingTo"):a.linkMode==="linkingTo"&&(n.emit("do",H=>{const re=H.createLinkEntry(H.currVideoCanvasSelected.value,x);H.createLink(a.firstLink,re)}),a.linkMode="selectable")})},z=F(()=>o.value===null?!1:o.value.moveRegionMode),V=F(()=>o.value===null?!1:o.value.editRegionMode),ve={moveRegionMode:"moveRegion",editRegionMode:"editRegion",frameLinkMode:"frameLink",hintMode:"hint"},fe=_=>{for(const x in ve){const H=$(`#${ve[x]}`);if(x===_){let re;n.emit("do",ge=>{ge[x].value=!ge[x].value,re=ge[x].value}),H.css("display",re?"flex":"none");continue}n.emit("do",re=>{re[x].value=!1}),H.css("display","none")}},Q=b(!1),Ce=()=>{fe("moveRegionMode")},N=()=>{fe("editRegionMode")},ce=()=>{fe("frameLinkMode")},Re=()=>{fe("hintMode")},Ae=(_,x)=>{n.emit(_,x)},se=Me([]),pe=b(null),_e=b(null);et(()=>{n.on("clickVideoCanvas",W),n.on("ready",()=>{o.value=n.emit("getManager")[0];let _="DCA";window.location.hash!==""&&(_=window.location.hash.substring(1)),n.emit("loadVideoCanvasState",_)}),$(".tool-change").css("display","none")});const he={manager:o,emitEvent:Ae,linkData:a,mapLinkData:i,linkVideoCanvasStyle:l,mapLinkClicked:d,addMap:c,mapLinkStyle:k,linkClicked:P,videoCanvasClicked:W,renderModes:se,renderModeRef:pe,moveRegionMode:z,editRegionMode:V,linkFrameToggleRef:_e,regionMoveToggled:Ce,regionEditToggled:N,frameLinkEditToggled:ce,hintToggled:Re,displayUI:Q};return We("UI",he),he}},fa={class:"tool-column",style:{height:"20vh"}},ha={class:"tool-row"},ga={class:"loadSave"},ma={class:"loadSave"},va={class:"tool-column",style:{height:"60vh"}},pa=C("span",{class:"text"},"Move Region",-1),ya=[pa],xa=C("span",{class:"text"},"Region Edit",-1),Ma=[xa],Ca=C("span",{style:{"font-size":"29px"}}," Frame Linking ",-1),_a=[Ca],ba=C("span",null,"Hints",-1),ka=[ba],wa={class:"middle"},Da={class:"tool-column tool-change",id:"moveRegion"},Sa={class:"tool-column tool-change",id:"editRegion"},$a={class:"tool-column tool-change",id:"frameLink"},Ra=C("ul",{class:"tool-column tool-change",id:"hint"},null,-1);function Ia(e,t,n,o,a,l){const i=Be("font-awesome-icon");return j(),G("div",{class:"grid-container",style:Z({"grid-template-rows":e.displayUI?"60px 1fr 0px":"0px 1fr 0px","grid-template-columns":e.displayUI?"240px 1fr 120px":"0px 1fr 0px"})},[C("div",{class:"header",style:Z({display:e.displayUI?"block":"none"})},st(e.manager?e.manager.appMode[0]:""),5),C("div",{class:"left",style:Z({display:e.displayUI?"block":"none"})},[C("div",fa,[C("ul",ha,[C("li",ga,[de(i,{icon:"save",class:"tool-item-left",style:{height:"50px",padding:"5px",display:"block"},onClick:t[0]||(t[0]=()=>e.emitEvent("saveVideoCanvasState"))})]),C("li",ma,[de(i,{icon:"file",class:"tool-item-left",style:{height:"50px",padding:"5px",display:"block"},onClick:t[1]||(t[1]=()=>e.emitEvent("loadVideoCanvasState",void 0))})])])]),C("ul",va,[C("li",{class:xe(["tool-item-left",e.manager&&e.manager.moveRegionMode?"activeInput":"inactiveInput"]),onClick:t[2]||(t[2]=(...d)=>e.regionMoveToggled&&e.regionMoveToggled(...d)),style:{cursor:"pointer"},ref:"moveRegionToggleRef"},ya,2),C("li",{class:xe(["tool-item-left",e.manager&&e.manager.editRegionMode?"activeInput":"inactiveInput"]),ref:"editRegionToggleRef",style:{cursor:"pointer"},onClick:t[3]||(t[3]=(...d)=>e.regionEditToggled&&e.regionEditToggled(...d))},Ma,2),C("li",{class:xe(["tool-item-left",e.manager&&e.manager.frameLinkMode?"activeInput":"inactiveInput"]),ref:"linkFrameToggleRef",style:{cursor:"pointer"},onClick:t[4]||(t[4]=(...d)=>e.frameLinkEditToggled&&e.frameLinkEditToggled(...d))},_a,2),C("li",{class:xe(["tool-item-left",e.manager&&e.manager.hintMode?"activeInput":"inactiveInput"]),ref:"helpToggleRef",style:{cursor:"pointer"},onClick:t[5]||(t[5]=(...d)=>e.hintToggled&&e.hintToggled(...d))},ka,2)])],4),C("div",wa,[St(e.$slots,"default")]),C("div",{class:"right",style:Z({display:e.displayUI?"block":"none"})},[C("ul",Da,[C("li",{class:xe(["tool-item",e.moveRegionMode?"activeInput":"inactiveInput"]),onClick:t[6]||(t[6]=()=>e.emitEvent("newCanvasClicked"))},[de(i,{icon:"plus-square"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[7]||(t[7]=()=>e.emitEvent("cutRegionClicked"))},[de(i,{icon:"cut"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[8]||(t[8]=()=>e.emitEvent("copyRegionClicked"))},[de(i,{icon:"copy"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[9]||(t[9]=()=>e.emitEvent("duplicateRegionClicked"))},[de(i,{icon:"clone"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.pasteBin?"activeInput":"inactiveInput"]),onClick:t[10]||(t[10]=()=>e.emitEvent("pasteRegionClicked"))},[de(i,{icon:"paste"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[11]||(t[11]=()=>e.emitEvent("deleteRegionClicked"))},[de(i,{icon:"trash"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[12]||(t[12]=()=>e.emitEvent("ZupClicked"))},[de(i,{icon:"arrow-up"})],2),C("li",{class:xe(["tool-item",e.moveRegionMode&&e.manager.currVideoCanvasSelected?"activeInput":"inactiveInput"]),onClick:t[13]||(t[13]=()=>e.emitEvent("ZdownClicked"))},[de(i,{icon:"arrow-down"})],2)]),C("ul",Sa,[C("li",{class:xe(["tool-item",e.editRegionMode&&e.manager.regionExists?"activeInput":"inactiveInput"]),onClick:t[14]||(t[14]=d=>e.emitEvent("newRegionClicked"))},[de(i,{icon:"border-none"})],2)]),C("ul",$a,[C("li",{class:"tool-item",style:Z(e.linkVideoCanvasStyle),onClick:t[15]||(t[15]=(...d)=>e.linkClicked&&e.linkClicked(...d))},[de(i,{icon:"link",style:Z({color:{linkingFrom:"green",linkingTo:"red"}[e.linkData.linkMode]||"white"})},null,8,["style"])],4),C("li",{class:"tool-item",style:Z(e.mapLinkStyle),onClick:t[16]||(t[16]=(...d)=>e.mapLinkClicked&&e.mapLinkClicked(...d))},[de(i,{icon:"map"})],4)]),Ra],4)],4)}var Ta=ke(da,[["render",Ia]]);const Pa={name:"MainPage",components:{loomManager:ua,loomUI:Ta},data:function(){return{directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/RVA",modifier_directory:"https://raw.githubusercontent.com/branson2015/DeRe_Apps/main/demos/demos"}}},Aa={id:"container"};function Oa(e,t,n,o,a,l){const i=Be("loom-manager"),d=Be("loom-u-i");return j(),G("div",Aa,[de(d,null,{default:$t(()=>[de(i,{directory:e.directory,modifier_directory:e.modifier_directory},null,8,["directory","modifier_directory"])]),_:1})])}var La=ke(Pa,[["render",Oa],["__scopeId","data-v-04d62d1f"]]);const Va={components:{MainPage:La},created(){window.addEventListener("mousemove",e=>{document.body.style.cursor="default",this.emitter.emit("mousemove",e)}),window.addEventListener("mouseup",e=>{document.body.style.cursor="default",this.emitter.emit("mouseup",e)}),window.addEventListener("mousedown",e=>{this.emitter.emit("mousedown",e)})}};function Ea(e,t,n,o,a,l){const i=Be("main-page");return j(),Xe(i)}var Fa=ke(Va,[["render",Ea]]);Rt.add(It,Tt,Pt,At,Ot,Lt,Vt,Et,Ft,Nt,Ht,Bt,Ut,jt);const Na=e=>{const t=Wt(e);return t.emitAsync=async function(n,o){let a=this.all.get(n);if(a)for(const l of a)await l(o);if(a=this.all.get("*"),a)for(const l of a)await l(n,o)},t.emit=function(n,o){let a=[],l=this.all.get(n);return l&&(a=a.concat(l.map(i=>i(o)))),l=this.all.get("*"),l&&(a=a.concat(l.map(i=>i(o)))),a},t},ft=Na(),Ke=zt(Fa);Ke.config.globalProperties.emitter=ft;Ke.provide("emitter",ft);Ke.component("font-awesome-icon",Yt);Ke.mount("#app");
